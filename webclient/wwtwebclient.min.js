/**
* WorldWide Telescope Web Client
* Copyright 2014-2015 WorldWide Telescope
* Licensed under MIT (https://github.com/WorldWideTelescope/wwt-web-client/blob/master/LICENSE.md)
**/
!function(a,b){"object"==typeof exports?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a)}(this,function(a){function b(a){this._targetElement=a,this._options={nextLabel:"Next &rarr;",prevLabel:"&larr; Back",skipLabel:"Skip",doneLabel:"Done",tooltipPosition:"bottom",tooltipClass:"",exitOnEsc:!0,exitOnOverlayClick:!0,showStepNumbers:!0,keyboardNavigation:!0,showButtons:!0,showBullets:!0,scrollToElement:!0}}function c(a){var b=[],c=this;if(this._options.steps)for(var e=[],i=0,k=this._options.steps.length;k>i;i++){var l=d(this._options.steps[i]);if(l.step=b.length+1,"string"==typeof l.element&&(l.element=document.querySelector(l.element)),"undefined"==typeof l.element||null==l.element){var m=document.querySelector(".introjsFloatingElement");null==m&&(m=document.createElement("div"),m.className="introjsFloatingElement",document.body.appendChild(m)),l.element=m,l.position="floating"}null!=l.element&&b.push(l)}else{var e=a.querySelectorAll("*[data-intro]");if(e.length<1)return!1;for(var i=0,n=e.length;n>i;i++){var p=e[i],q=parseInt(p.getAttribute("data-step"),10);q>0&&(b[q-1]={element:p,intro:p.getAttribute("data-intro"),step:parseInt(p.getAttribute("data-step"),10),tooltipClass:p.getAttribute("data-tooltipClass"),position:p.getAttribute("data-position")||this._options.tooltipPosition})}for(var r=0,i=0,n=e.length;n>i;i++){var p=e[i];if(null==p.getAttribute("data-step")){for(;;){if("undefined"==typeof b[r])break;r++}b[r]={element:p,intro:p.getAttribute("data-intro"),step:r+1,tooltipClass:p.getAttribute("data-tooltipClass"),position:p.getAttribute("data-position")||this._options.tooltipPosition}}}}for(var s=[],t=0;t<b.length;t++)b[t]&&s.push(b[t]);if(b=s,b.sort(function(a,b){return a.step-b.step}),c._introItems=b,o.call(c,a)){f.call(c);a.querySelector(".introjs-skipbutton"),a.querySelector(".introjs-nextbutton");c._onKeyDown=function(b){27===b.keyCode&&1==c._options.exitOnEsc?(h.call(c,a),void 0!=c._introExitCallback&&c._introExitCallback.call(c)):37===b.keyCode?g.call(c):(39===b.keyCode||13===b.keyCode)&&(f.call(c),b.preventDefault?b.preventDefault():b.returnValue=!1)},c._onResize=function(a){j.call(c,document.querySelector(".introjs-helperLayer"))},window.addEventListener?(this._options.keyboardNavigation&&window.addEventListener("keydown",c._onKeyDown,!0),window.addEventListener("resize",c._onResize,!0)):document.attachEvent&&(this._options.keyboardNavigation&&document.attachEvent("onkeydown",c._onKeyDown),document.attachEvent("onresize",c._onResize))}return!1}function d(a){if(null==a||"object"!=typeof a||"undefined"!=typeof a.nodeType)return a;var b={};for(var c in a)b[c]=d(a[c]);return b}function e(a){this._currentStep=a-2,"undefined"!=typeof this._introItems&&f.call(this)}function f(){if(!$(".introjs-nextbutton").prop("disabled")){if(this._direction="forward","undefined"==typeof this._currentStep?this._currentStep=0:++this._currentStep,this._introItems.length<=this._currentStep)return"function"==typeof this._introCompleteCallback&&this._introCompleteCallback.call(this),void h.call(this,this._targetElement);var a=this._introItems[this._currentStep];"undefined"!=typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,a.element),k.call(this,a)}}function g(){return}function h(a){var b=a.querySelector(".introjs-overlay");if(null!=b){b.style.opacity=0,setTimeout(function(){b.parentNode&&b.parentNode.removeChild(b)},500);var c=a.querySelector(".introjs-helperLayer");c&&c.parentNode.removeChild(c);var d=document.querySelector(".introjsFloatingElement");d&&d.parentNode.removeChild(d);var e=document.querySelector(".introjs-showElement");e&&(e.className=e.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,""));var f=document.querySelectorAll(".introjs-fixParent");if(f&&f.length>0)for(var g=f.length-1;g>=0;g--)f[g].className=f[g].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");window.removeEventListener?window.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown),this._currentStep=void 0}}function i(a,b,c,d){if(b.style.top=null,b.style.right=null,b.style.bottom=null,b.style.left=null,b.style.marginLeft=null,b.style.marginTop=null,c.style.display="inherit","undefined"!=typeof d&&null!=d&&(d.style.top=null,d.style.left=null),this._introItems[this._currentStep]){var e="",f=this._introItems[this._currentStep];e="string"==typeof f.tooltipClass?f.tooltipClass:this._options.tooltipClass,b.className=("introjs-tooltip "+e).replace(/^\s+|\s+$/g,"");var e=this._options.tooltipClass,g=this._introItems[this._currentStep].position;switch(g){case"top":b.style.left="15px",b.style.top="-"+(p(b).height+10)+"px",c.className="introjs-arrow bottom";break;case"right":b.style.left=p(a).width+20+"px",c.className="introjs-arrow left";break;case"left":1==this._options.showStepNumbers&&(b.style.top="15px"),b.style.right=p(a).width+20+"px",c.className="introjs-arrow right";break;case"floating":c.style.display="none";var h=p(b);b.style.left="50%",b.style.top="50%",b.style.marginLeft="-"+h.width/2+"px",b.style.marginTop="-"+h.height/2+"px","undefined"!=typeof d&&null!=d&&(d.style.left="-"+(h.width/2+18)+"px",d.style.top="-"+(h.height/2+18)+"px");break;case"bottom":default:b.style.bottom="-"+(p(b).height+10)+"px",c.className="introjs-arrow top"}}}function j(a){if(a){if(!this._introItems[this._currentStep])return;var b=this._introItems[this._currentStep],c=p(b.element),d=10;"floating"==b.position&&(d=0),a.setAttribute("style","width: "+(c.width+d)+"px; height:"+(c.height+d)+"px; top:"+(c.top-5)+"px;left: "+Math.max(c.left-5,0)+"px;")}}function k(a){"undefined"!=typeof this._introChangeCallback&&this._introChangeCallback.call(this,a.element);var b=this,c=document.querySelector(".introjs-helperLayer");p(a.element);if(null!=c){var d=c.querySelector(".introjs-helperNumberLayer"),e=c.querySelector(".introjs-tooltiptext"),k=c.querySelector(".introjs-arrow"),o=c.querySelector(".introjs-tooltip"),q=c.querySelector(".introjs-skipbutton"),r=c.querySelector(".introjs-prevbutton"),s=c.querySelector(".introjs-nextbutton");if(o.style.opacity=0,null!=d){var t=this._introItems[a.step-2>=0?a.step-2:0];(null!=t&&"forward"==this._direction&&"floating"==t.position||"backward"==this._direction&&"floating"==a.position)&&(d.style.opacity=0)}j.call(b,c);var u=document.querySelectorAll(".introjs-fixParent");if(u&&u.length>0)for(var v=u.length-1;v>=0;v--)u[v].className=u[v].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");var w=document.querySelector(".introjs-showElement");w.className=w.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,""),b._lastShowElementTimer&&clearTimeout(b._lastShowElementTimer),b._lastShowElementTimer=setTimeout(function(){null!=d&&(d.innerHTML=a.step),e.innerHTML=a.intro,i.call(b,a.element,o,k,d),c.querySelector(".introjs-bullets li > a.active").className="",c.querySelector('.introjs-bullets li > a[data-stepnumber="'+a.step+'"]').className="active",o.style.opacity=1,d&&(d.style.opacity=1)},350)}else{var x=document.createElement("div"),y=document.createElement("div"),z=document.createElement("div"),A=document.createElement("div"),B=document.createElement("div"),C=document.createElement("div");x.className="introjs-helperLayer",j.call(b,x),this._targetElement.appendChild(x),y.className="introjs-arrow",A.className="introjs-tooltiptext",A.innerHTML=a.intro,B.className="introjs-bullets",this._options.showBullets===!1&&(B.style.display="none");for(var D=document.createElement("ul"),v=0,E=this._introItems.length;E>v;v++){var F=document.createElement("li"),G=document.createElement("a");G.onclick=function(){b.goToStep(this.getAttribute("data-stepnumber"))},0===v&&(G.className="active"),G.href="javascript:void(0);",G.innerHTML="&nbsp;",G.setAttribute("data-stepnumber",this._introItems[v].step),F.appendChild(G),D.appendChild(F)}if(B.appendChild(D),C.className="introjs-tooltipbuttons",this._options.showButtons===!1&&(C.style.display="none"),z.className="introjs-tooltip",z.appendChild(A),z.appendChild(B),1==this._options.showStepNumbers){var H=document.createElement("span");H.className="introjs-helperNumberLayer",H.innerHTML=a.step,x.appendChild(H)}z.appendChild(y),x.appendChild(z);var s=document.createElement("a");s.onclick=function(){b._introItems.length-1!=b._currentStep&&f.call(b)},s.href="javascript:void(0);",s.innerHTML=this._options.nextLabel;var r=document.createElement("a");r.onclick=function(){0!=b._currentStep&&g.call(b)},r.href="javascript:void(0);",r.innerHTML=this._options.prevLabel;var q=document.createElement("a");q.className="introjs-button introjs-skipbutton",q.href="javascript:void(0);",q.innerHTML=this._options.skipLabel,q.onclick=function(){b._introItems.length-1==b._currentStep&&"function"==typeof b._introCompleteCallback&&b._introCompleteCallback.call(b),b._introItems.length-1!=b._currentStep&&"function"==typeof b._introExitCallback&&b._introExitCallback.call(b),h.call(b,b._targetElement)},C.appendChild(q),this._introItems.length>1&&(C.appendChild(r),C.appendChild(s)),z.appendChild(C),i.call(b,a.element,z,y,H)}0==this._currentStep&&this._introItems.length>1?(r.className="introjs-button introjs-prevbutton introjs-disabled",s.className="introjs-button introjs-nextbutton",q.innerHTML=this._options.skipLabel):this._introItems.length-1==this._currentStep||1==this._introItems.length?(q.innerHTML=this._options.doneLabel,r.className="introjs-button introjs-prevbutton",s.className="introjs-button introjs-nextbutton introjs-disabled"):(r.className="introjs-button introjs-prevbutton",s.className="introjs-button introjs-nextbutton",q.innerHTML=this._options.skipLabel),s.focus(),a.element.className+=" introjs-showElement";var I=l(a.element,"position");"absolute"!==I&&"relative"!==I&&(a.element.className+=" introjs-relativePosition");for(var J=a.element.parentNode;null!=J&&"body"!==J.tagName.toLowerCase();){var K=l(J,"z-index"),L=parseFloat(l(J,"opacity"));(/[0-9]+/.test(K)||1>L)&&(J.className+=" introjs-fixParent"),J=J.parentNode}if(!n(a.element)&&this._options.scrollToElement===!0){var M=a.element.getBoundingClientRect(),N=m().height,O=M.bottom-(M.bottom-M.top),P=M.bottom-N;0>O||a.element.clientHeight>N?window.scrollBy(0,O-30):window.scrollBy(0,P+100)}"undefined"!=typeof this._introAfterChangeCallback&&this._introAfterChangeCallback.call(this,a.element)}function l(a,b){var c="";return a.currentStyle?c=a.currentStyle[b]:document.defaultView&&document.defaultView.getComputedStyle&&(c=document.defaultView.getComputedStyle(a,null).getPropertyValue(b)),c&&c.toLowerCase?c.toLowerCase():c}function m(){if(void 0!=window.innerWidth)return{width:window.innerWidth,height:window.innerHeight};var a=document.documentElement;return{width:a.clientWidth,height:a.clientHeight}}function n(a){var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.bottom+80<=window.innerHeight&&b.right<=window.innerWidth}function o(a){var b=document.createElement("div"),c="",d=this;if(b.className="introjs-overlay","body"===a.tagName.toLowerCase())c+="top: 0;bottom: 0; left: 0;right: 0;position: fixed;",b.setAttribute("style",c);else{var e=p(a);e&&(c+="width: "+e.width+"px; height:"+e.height+"px; top:"+e.top+"px;left: "+Math.max(0,e.left)+"px;",b.setAttribute("style",c))}return a.appendChild(b),b.onclick=function(){1==d._options.exitOnOverlayClick&&(h.call(d,a),void 0!=d._introExitCallback&&d._introExitCallback.call(d))},setTimeout(function(){c+="opacity: .8;",b.setAttribute("style",c)},10),!0}function p(a){var b={};b.width=a.offsetWidth,b.height=a.offsetHeight;for(var c=0,d=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent;return b.top=d,b.left=c,b}function q(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}var r="0.8.0",s=function(a){if("object"==typeof a)return new b(a);if("string"==typeof a){var c=document.querySelector(a);if(c)return new b(c);throw new Error("There is no element with given selector.")}return new b(document.body)};return s.version=r,s.fn=b.prototype={clone:function(){return new b(this)},setOption:function(a,b){return this._options[a]=b,this},setOptions:function(a){return this._options=q(this._options,a),this},start:function(){return c.call(this,this._targetElement),this},goToStep:function(a){return e.call(this,a),this},nextStep:function(){return f.call(this),this},previousStep:function(){return g.call(this),this},exit:function(){h.call(this,this._targetElement)},refresh:function(){return j.call(this,document.querySelector(".introjs-helperLayer")),this},onbeforechange:function(a){if("function"!=typeof a)throw new Error("Provided callback for onbeforechange was not a function");return this._introBeforeChangeCallback=a,this},onchange:function(a){if("function"!=typeof a)throw new Error("Provided callback for onchange was not a function.");return this._introChangeCallback=a,this},onafterchange:function(a){if("function"!=typeof a)throw new Error("Provided callback for onafterchange was not a function");return this._introAfterChangeCallback=a,this},oncomplete:function(a){if("function"!=typeof a)throw new Error("Provided callback for oncomplete was not a function.");return this._introCompleteCallback=a,this},onexit:function(a){if("function"!=typeof a)throw new Error("Provided callback for onexit was not a function.");return this._introExitCallback=a,this}},a.introJs=s,s});var ngIntroDirective=angular.module("angular-intro",[]);ngIntroDirective.directive("ngIntroOptions",["$timeout","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){c[e.ngIntroMethod]=function(a){var d;d="string"==typeof a?introJs(a):introJs(),d.setOptions(c.$eval(e.ngIntroOptions)),e.ngIntroOncomplete&&d.oncomplete(b(e.ngIntroOncomplete)(c)),e.ngIntroOnexit&&d.onexit(b(e.ngIntroOnexit)(c)),e.ngIntroOnchange&&d.onchange(b(e.ngIntroOnchange)(c)),e.ngIntroOnbeforechange&&d.onbeforechange(b(e.ngIntroOnbeforechange)(c)),e.ngIntroOnafterchange&&d.onafterchange(b(e.ngIntroOnafterchange)(c)),"number"==typeof a?d.goToStep(a).start():d.start()},"true"==e.ngIntroAutostart&&a(function(){b(e.ngIntroMethod)(c)()})}}}]);var wwt={app:angular.module("wwtApp",["mgcrea.ngStrap","ngTouch","ngAnimate","ngRoute","wwtControllers","ngCookies","angular-intro"]),controllers:angular.module("wwtControllers",[]),triggerResize:function(){},resize:function(){$("body.mobile #WWTCanvas").height($("#WorldWideTelescopeControlHost").height()).width($("#WorldWideTelescopeControlHost").width()),$("body.desktop #WWTCanvas").height($(window).height()).width($(window).width())}};$(window).on("load",function(){wwt.resize();var a=document.createElement("script");a.setAttribute("src","searchdata.min.js"),document.getElementsByTagName("head")[0].appendChild(a)}),wwt.app.directive("scrollBuffer",["$window",function(a){return function(a,b,c){for(var d=parseInt(c.scrollBuffer),e=a,f=$(b).parent();!f.hasClass("modal-dialog");)f=f.parent();f.on("scroll",function(){var a=this.scrollTop,b=$(this),c=b.width(),f=b.height(),g=b.find(".modal-content div.tn").first(),h=Math.floor(c/g.width()),i=Math.ceil((a+f)/g.height()),j=(i+d)*h;e.scrollDepth<j&&(e.scrollDepth=j,e.$apply())})}}]),wwt.app.directive("jqueryScrollbar",["$rootScope","$window",function(a,b){return function(a,b,c){var d=$(b).find(".jspPane");$(b).on("mousewheel",function(a){var c=a.originalEvent;d=$(b).find(".jspPane");var e,f=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail)),g=Math.abs(Math.floor(d.position().left)),h=155;0>f?(console.log("down"),e=Math.floor((g+h)/h)*h):(console.log("up"),e=Math.floor((g-h)/h)*h),console.log(g,e),$(b).data("jsp").scrollToX(Math.abs(e))})}}]),wwt.app.directive("localize",["Localization","$rootScope","AppState","Util",function(a,b,c,d){return function(e,f,g){function h(b){try{if(""===g.localize)return void setTimeout(function(){h(b)},200);var c=$(f),e=new RegExp(g.localize,"g"),i=b?g.localize:a.getFromEn(g.localize);if(g.locAttrOnly||g.localizeOnly||(-1==c.html().indexOf(g.localize)||b?c.html(i):c.html(c.html().replace(e,i))),g.localizeAttr||g.localizeOnly){var j=g.localizeAttr||g.localizeOnly;c.attr(j)&&-1!=c.attr(j).indexOf(i)&&!b?c.attr(j,c.attr(j).replace(e,i)):c.attr(j,i)}}catch(k){d.log("localize",k)}}"EN"!==c.get("language")?b.languagePromise.then(function(){h(!1)}):h(!0)}}]),wwt.app.directive("ngContextMenu",["$dropdown",function(a){return{restrict:"A",scope:{method:"&ngContextMenu"},link:function(a,b){var c=a.method();b.bind("contextmenu",function(a){a.preventDefault();var b=a.delegateTarget.getAttribute("index");b?c(parseInt(b),a):c&&c(a)})}}}]),wwt.app.directive("ngRightClick",function(a){return function(b,c,d){var e=a(d.ngRightClick);c.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault(),e(b,{$event:a})})})}}),wwt.app.directive("contenteditable",[function(){return{restrict:"A",link:function(a,b,c){function d(){var a,c,d,e=b.html(),f=e.split(":"),h=0;if(2===f.length)c=parseInt(f[0].replace(/\D/g,"")),d=f[1].split(".");else{if(1!==f.length)return void(j.duration=g);c=0,d=f[0].split(".")}a=parseInt(d[0].replace(/\D/g,"")),2===d.length&&(h=parseInt(d[1].replace(/\D/g,""))),j.duration=6e4*c+1e3*a+100*h}function e(){j.duration>100?g=j.duration:j.duration=g,j.minDuration=Math.floor(j.duration/6e4);var a=j.duration%6e4/1e3;j.secDuration=Math.floor(a),j.tenths=a%1===0?".0":a%1,j.durationString=j.minDuration+":"+(j.secDuration<10?"0":"")+j.secDuration+j.tenths,b.html(j.durationString)}function f(){setTimeout(function(){var a=b.text(),c=document.createRange();c.setStart(k.firstChild,a.indexOf(":")+1),c.setEnd(k.firstChild,a.indexOf("."));var d=window.getSelection();d.removeAllRanges(),d.addRange(c)},10)}var g,h=b.hasClass("duration"),i=a.stop,j=i,k=$(b)[0];h?e():b.html(j.description),b.on("keyup",function(a){if(h)switch(a.keyCode){case 33:case 38:return i.duration+=1e3,void e();case 34:case 40:return i.duration-=1e3,void e();case 27:case 13:case 9:return void b.blur();default:d()}});var l=!1;h&&b.on("focus",function(){l||(a.$apply(function(){i.editingDuration=!0}),b.parent().find(".tinybutton").on("mousedown",function(a){l=!0,setTimeout(function(){l=!1},500);var b=$(this);b.hasClass("duration-up")?(i.duration+=1e3,e()):(i.duration-=1e3,e()),f()}),b.parent().find(".tinybutton").on("mouseup",f))}),b.on("blur",function(){l||a.$applyAsync(function(){h?(d(),e(),i.set_duration(g),i.editingDuration=!1):j.set_description(b.html())})})}}}]),wwt.app.factory("AppState",function(){function a(a,b){try{d[a]=b,localStorage&&localStorage.setItem("appState",JSON.stringify(d))}catch(c){console.log("Error using localstorage. Is it turned off?")}}function b(a){return d[a]}function c(){return d}var d,e={set:a,get:b,getAll:c},f=function(){var a=localStorage?localStorage.getItem("appState"):{};d=a&&localStorage?JSON.parse(a):{}};return f(),e}),wwt.app.factory("Localization",["$http","$q","Util",function(a,b,c){function d(a,b){return l&&l[a]?l[a]:b?b:""}function e(a){return"EN"===h?a:d($.inArray(a,j),a)}function f(){var a=b.defer();return q.then(function(){var b=[];m.find("languagepack").each(function(a,c){b.push({label:$(c).attr("name"),code:$(c).attr("code")})}),a.resolve(b)}),a.promise}function g(d){var e=b.defer();return q.then(function(){if(h=d,"EN"===d)return k=i,l=k.split("\n"),void e.resolve(!0);var b=m.find("languagepack[code="+d+"]").attr("url");c.log(b),a.get(b).success(function(a){a=p(a),k=a,l=[],$.each(a.split("\n"),function(a,b){var c=b.split("	"),d=parseInt(c[0],10);2!==c.length||isNaN(d)||(l[d]=c[1])}),e.resolve(!0)})}),e.promise}var h,i,j,k,l,m,n={setLanguage:g,getString:d,getFromEn:e,getAvailableLanguages:f},o=function(){var d=b.defer();return b.all([a.get("http://www.worldwidetelescope.org/wwtweb/catalog.aspx?X=Languages").success(function(a){m=$(a)}).error(function(a,b,d,e){c.log(a,b,d,e)}),a.get("http://www.worldwidetelescope.org/wwtweb/catalog.aspx?Q=lang_en").success(function(a){a=p(a),i=a;var b=a.split("\n");j=[],$.each(b,function(){var a=this.split("	")[1];a&&(a=a.split("\r")[0]),j[parseInt(this.split("	")[0])]=a})})]).then(function(){d.resolve(!0)}),d.promise},p=function(a){if(1==a.charAt(0))return a;var b=new RegExp(a.charAt(0),"g"),c=new RegExp(a.charAt(3),"g");return a.replace(b,"").replace(c,"")},q=o();return n}]),wwt.app.factory("FinderScope",["SearchData","$timeout","Util",function(a,b,c){function d(){a.getData().then(function(a){f=a,e()})}function e(){if(!f)return!1;var a=$(".finder-scope").position(),b=301,d=87,e=wwtlib.WWTControl.singleton.getCoordinatesForScreenPoint(a.left+b,a.top+d);e.x=(e.x+720)%360;var g,h,i,j,k=wwtlib.Coordinates.raDecTo3d(e.x,e.y),l=wwtlib.Constellations.containment.findConstellationForPoint(e.x,e.y);$.each(f.Constellations,function(a,b){b.name===l?i=b.places:"SolarSystem"===b.name&&(j=b.places)});var m=j.concat(i);return $.each(m,function(a,b){try{var d=wwtlib.Vector3d.subtractVectors(b.get_location3d(),k);(0===a||g.length()>d.length())&&(h=b,g=d)}catch(e){b&&"Earth"!=b.get_name()&&c.log(e)}}),c.getAstroDetails(h),h}var f,g={init:d,scopeMove:e};return g}]),wwt.app.factory("ThumbList",["$rootScope","Util","Places","$timeout",function(a,b,c,d){function e(a,c){a.pageCount=1,a.pageSize=1,a.currentPage=0,a.preventClickBubble=function(a){a.stopImmediatePropagation()},a.goBack=function(){h(a)},a.goFwd=function(){i(a)},a.showMenu=function(e){var f=a.collectionPage[e];if(f.contextMenuEvent=!0,$(".popover-content .close-btn").click(),!f.get_isFolder()&&"Up Level"!==f.get_name()){var g=$(("context"===c?".nearby-objects ":".top-panel ")+"#menuContainer"+e);b.isMobile&&(g=$("#"+c+"Container #menuContainer"+e)),g.append($("#researchMenu")),setTimeout(function(){$(".popover-content .close-btn").click(),g.find("#researchMenu").addClass("open").off("click").on("click",function(a){a.stopPropagation()}),g.find(".drop-toggle").click(),d(function(){b.isMobile||($(".dropdown-backdrop").off("contextmenu"),$(".dropdown-backdrop").on("contextmenu",function(a){$(this).click(),a.preventDefault()})),a.setMenuContextItem(f,!0),f.contextMenuEvent=!1},10)},10)}},a.expandThumbnails=function(b){$("body").append($("#researchMenu")),a.currentPage=0,a.expanded=void 0!=b?b:!a.expanded,a.expandTop(a.expanded,c),g(a,"context"===c)},a.dropdownClass="context"!==c||b.isMobile?"dropdown menu-container":"dropup menu-container",a.popupPosition="context"!==c||b.isMobile?"bottom":"top"}function f(d,e,f,h){return d.contextMenuEvent?f:(f||(f={}),e.activeItem=d.get_thumbnailUrl()+d.get_name(),e.setActiveItem(d),wwt.wc.clearAnnotations(),"Up Level"===d.get_name()?($("body").append($("#researchMenu")),e.currentPage=0,f.depth--,f.breadCrumb.pop(),e.breadCrumb=f.breadCrumb,f.cache.pop(),e.collection=f.cache[f.cache.length-1],g(e,!1),f):d.get_url&&d.get_url()&&-1!==d.get_url().indexOf("?wwtfull")?(window.open(d.get_url()),f):d.get_isFolder()?($("#folderLoadingModal").modal("show"),$("body").append($("#researchMenu")),e.currentPage=0,f.depth++,f.breadCrumb.push(d.get_name()),e.breadCrumb=f.breadCrumb,c.getChildren(d).then(function(a){$("#folderLoadingModal").modal("hide"),$.isArray(a[0])&&(a=a[0]);var b=[];if($.each(a,function(a,c){-1===$.inArray(c,b)&&b.push(c)}),e.collection=b,g(e,!1),f.cache.push(a),f.openCollection)if(f.newCollectionUrl){for(var c=0;a[c].url&&-1===a[c].url.indexOf(f.newCollectionUrl);)c++;e.clickThumb(a[c]),f.newCollectionUrl=null}else a.length&&e.clickThumb(a[0]);h&&h()}),f):(f.openCollection?f.openCollection=!1:e.$hide?(e.$hide(),a.searchModal=!1):b.isMobile&&$("#explorerModal").modal("hide"),d.isFGImage&&d.imageSet&&"Sky"!==e.lookAt||d.isSurvey?(e.setLookAt("Sky",d.get_name(),!0,d.isSurvey),d.isSurvey?e.setSurveyBg(d.get_name(),d):e.setForegroundImage(d),e.$hide&&(e.$hide(),a.searchModal=!1),f):(d.isPanorama?e.setLookAt("Panorama",d.get_name()):d.isEarth?e.setLookAt("Earth",d.get_name()):b.getIsPlanet(d)&&"SolarSystem"!==e.lookAt?e.setLookAt("Planet",d.get_name()):d.isPlanet&&"SolarSystem"!==e.lookAt&&e.setLookAt("Planet",""),!ss.canCast(d,wwtlib.Place)&&!d.isEarth||d.isSurvey||e.setForegroundImage(d),ss.canCast(d,wwtlib.Tour)&&e.playTour(d.get_tourUrl()),f)))}function g(a,c){var e=a.collection,f=116,g=$(window).width();!c||"Sky"!==a.lookAt&&"SolarSystem"!==a.lookAt||(g-=216),a.pageSize=b.isMobile?99999:Math.floor(g/f),a.expanded&&(a.pageSize*=5);var h=e?e.length:2;d(function(){a.pageCount=Math.ceil(h/a.pageSize),j(a)},10)}function h(a){return $("body").append($("#researchMenu")),a.currentPage=0===a.currentPage?a.currentPage:a.currentPage-1,j(a)}function i(a){return $("body").append($("#researchMenu")),a.currentPage=a.currentPage===a.pageCount-1?a.currentPage:a.currentPage+1,j(a)}function j(a){if(a.collection){var b=a.currentPage*a.pageSize;a.collectionPage=a.collection.slice(b,b+a.pageSize)}}var k={init:e,clickThumb:f,calcPageSize:g,spliceOnePage:j,goFwd:i,goBack:h};return k}]),wwt.app.factory("Util",["$rootScope",function(a){function b(a){if(a&&!isNaN(parseInt(a))){var b;$.each(wwtlib.Classification,function(c,d){d===a&&(b=c)});var c=b.replace(/^\s*/,"");return c=c.replace(/^[a-z]|[^\s][A-Z]/g,function(a,b){return 0==b?a.toUpperCase():a.substr(0,1)+" "+a.substr(1).toUpperCase()})}return null}function c(a,b){for(var c=new Date((new Date).toUTCString()).valueOf()-(new Date).valueOf(),e=c/36e5,f=a-e+.0083333334;f>24;)f-=24;for(;0>f;)f+=24;var g=f.toFixed(0),h=(60*f-60*g).toFixed(0),i=b?" : ":":";return[d(g),d(h)].join(i)}function d(a){return Math.abs(Math.floor(a))<10?0>a?"-0"+Math.abs(Math.floor(a)):"0"+Math.floor(a):Math.floor(a)}function e(a,b,c,e){var f=60*(a-Math.floor(a)),g=60*(f-Math.floor(f)),h=e?" : ":":";return isNaN(a)&&(a=f=g=0),b?d(a)+"h"+d(f)+"m"+d(g)+"s":[c&&a>0?"+"+d(a):d(a),d(f),d(g)].join(h)}function f(a){function b(a,b,c){var d=parseInt(a)+parseInt(b)/60+parseInt(c)/3600;return d}var c;return-1!=a.indexOf(":")?c=a.split(":"):-1!=a.indexOf("h")&&(c=a.replace(/h/,",").replace(/m/,",").replace(/s/,"").split(",")),c?b(c[0],c[1],c[2]):parseFloat(a)}function g(a){var c=wwtlib.Coordinates.fromRaDec(a.get_RA(),a.get_dec()),d=wwtlib.SpaceTimeController,e=wwtlib.Coordinates.equitorialToHorizon(c,d.get_location(),d.get_now());a.altAz=e;var f,g=b(a.get_classification());if("Solar System"==g){var h=d.get_jNow()+.5,i=wwtlib.Planets.getPlanetLocation(a.get_name(),h-1),j=wwtlib.Planets.getPlanetLocation(a.get_name(),h),k=wwtlib.Planets.getPlanetLocation(a.get_name(),h+1),l=0;switch(a.get_name()){case"Sun":l=1;break;case"Moon":l=2;break;default:l=0}f=wwtlib.AstroCalc.getRiseTrinsitSet(h,d.get_location().get_lat(),-d.get_location().get_lng(),i.RA,i.dec,j.RA,j.dec,k.RA,k.dec,l)}else f=wwtlib.AstroCalc.getRiseTrinsitSet(d.get_jNow()+.5,d.get_location().get_lat(),-d.get_location().get_lng(),a.get_RA(),a.get_dec(),a.get_RA(),a.get_dec(),a.get_RA(),a.get_dec(),0);f.bValid||f.bNeverRises||(f.bNeverSets=!0),a.riseSet=f}function h(a){if(wwt.wc.clearAnnotations(),"2"===$("#lstLookAt").val()){var b=wwt.wc.createCircle();b.set_center(a.get_location3d()),b.set_skyRelative(!1),wwt.wc.addAnnotation(b)}}function i(a){var c,d;return"function"==typeof a.get_classification&&(c=a.get_classification(),d="Solar System"===b(c)),d||"function"==typeof a.get_rotation}function j(a){var b=Math.floor(a/3600),c=a%3600,d=Math.floor(c/60),e=c%60,f=Math.ceil(e),g={h:10>b?"0"+b:b.toString(),m:10>d?"0"+d:d.toString(),s:10>f?"0"+f:f.toString()};return g}function k(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?null:decodeURIComponent(c[1].replace(/\+/g," "))}function l(a){return a?ss.canCast(a,wwtlib.Imageset)?a:a.get_backgroundImageset&&ss.canCast(a.get_backgroundImageset(),wwtlib.Imageset)?a.get_backgroundImageset():a.get_studyImageset&&ss.canCast(a.get_studyImageset(),wwtlib.Imageset)?a.get_studyImageset():null:null}function m(a){var b=l(a);return b?b.get_creditsText():""}function n(a){var b=l(a);return b?b.get_creditsUrl():""}function o(){return x}function p(){null!=k("debug")&&console.log(arguments)}function q(a){y()&&0!==a.indexOf("http")&&(a="http://worldwidetelescope.org"+a),window.open(a)}function r(a){a||(location.hash="/"),wwt.wc.gotoRaDecZoom(0,0,60,!0)}function s(){w?(wwt.exitFullScreen(),w=!1):(wwt.requestFullScreen(document.body),w=!0)}function t(a){return z.length||$.each(wwtlib.ImageSetType,function(a,b){isNaN(b)||(z[b]=a.toLowerCase())}),-1==z.indexOf(a.toLowerCase())?2:z.indexOf(a.toLowerCase())}function u(){C={isDirty:!1,init:!0,RA:wwt.wc.getRA(),Dec:wwt.wc.getDec(),Fov:wwt.wc.get_fov()},a.$broadcast("viewportchange",C),a.languagePromise.then(function(){C={isDirty:!1,init:!0,RA:wwt.wc.getRA(),Dec:wwt.wc.getDec(),Fov:wwt.wc.get_fov()},a.$broadcast("viewportchange",C),C.init=!1,B=setInterval(D,250)})}var v={getClassificationText:b,getAstroDetails:g,formatDecimalHours:c,formatHms:e,drawCircleOverPlace:h,getIsPlanet:i,secondsToTime:j,getQSParam:k,getImageset:l,getCreditsText:m,getCreditsUrl:n,isAccelDevice:o,isMobile:$("body").hasClass("mobile"),isStaging:function(){return-1===location.href.indexOf("worldwidetelescope")},isDebug:null!=k("debug"),nav:q,log:p,resetCamera:r,toggleFullScreen:s,getImageSetType:t,trackViewportChanges:u,parseHms:f},w=!1,x=!1,y=function(){return 1==$("body").data("standalone-mode")},z=[],A=function(b){switch(b.keyCode){case 27:a.$broadcast("escKey")}};$(document).on("keyup",A);var B,C={isDirty:!1,RA:0,Dec:0,Fov:60},D=function(){var b=C.isDirty;C.isDirty=wwt.wc.getRA()!==C.RA||wwt.wc.getDec()!==C.Dec||wwt.wc.get_fov()!==C.Fov,C.RA=wwt.wc.getRA(),C.Dec=wwt.wc.getDec(),C.Fov=wwt.wc.get_fov(),(C.isDirty||b)&&(a.viewport=C,a.$broadcast("viewportchange",C))};return v}]),wwt.app.factory("UILibrary",["$rootScope","AppState","Util","Localization",function(a,b,c,d){return a.layerManagerHidden=b.get("layerManagerHidden")?!0:!1,a.toggleLayerManager=function(){a.layerManagerHidden=!a.layerManagerHidden,b.set("layerManagerHidden",a.layerManagerHidden)},a.getCreditsText=function(a){return c.getCreditsText(a)},a.getCreditsUrl=function(a){return c.getCreditsUrl(a)},a.getClassificationText=function(a){var b=c.getClassificationText(a);return b||d.getFromEn("Unknown")},a.secondsToTime=function(a){return c.secondsToTime(a)},a.isMobile=c.isMobile,a.resLocation=$("body").data("res-location"),a.bottomControlsWidth=function(){return angular.element("div.context-panel").width()-angular.element("body.desktop .fov-panel").width()+1},a.layerManagerHeight=function(){return $(window).height()-(168+$("body.desktop .context-panel").height())},!0}]),wwt.app.factory("SearchUtil",["SearchData","$q","Util","$rootScope",function(a,b,c,d){function e(c){var d=b.defer();return a.getIndex().then(function(a){var b=wwt.searchDataIndexed,e=[];if(c.length<2)e=b[c];else{var f=b[c.charAt(0).toLowerCase()];$.each(f,function(a,b){var d=b.get_names(),f=!1;$.each(d,function(a,d){if(-1===c.indexOf(" ")&&d.split(" ").length>1){var g=d.split(" ");$.each(g,function(a,d){0!==d.toLowerCase().indexOf(c.toLowerCase())||f||(e.push(b),f=!0)})}else 0!==d.toLowerCase().indexOf(c.toLowerCase())||f||(e.push(b),f=!0)})})}d.resolve(e.sort(i))}),d.promise}function f(c){var d=b.defer();return a.getData().then(function(a){var b=parseInt(c.split(".")[0]),e=parseInt(c.split(".")[1]);d.resolve(a.Constellations[b].places[e])}),d.promise}function g(e){var f=b.defer();return a.getData().then(function(a){var b=wwt.searchData;if(!d.viewport||"Sky"!==e.lookAt&&"SolarSystem"!==e.lookAt)f.resolve([]);else{var g,h,j=e.singleton.getCoordinatesForScreenPoint(0,0),k=wwtlib.Coordinates.raDecTo3d(j.x,j.y),l=wwtlib.Coordinates.raDecTo3d(d.viewport.RA,d.viewport.Dec),m=wwtlib.Vector3d.subtractVectors(k,l),n=e.singleton.constellation;$.each(b.Constellations,function(a,b){b.name===n?g=b.places:"SolarSystem"===b.name&&(h=b.places)}),"SolarSystem"===e.lookAt&&f.resolve(h);var o=h.concat(g),p=[];$.each(o,function(a,b){if(b&&"Earth"!==b.get_name())try{var d=wwtlib.Vector3d.subtractVectors(b.get_location3d(),l);m.length()>d.length()&&p.push(b)}catch(e){c.log(e,b)}}),f.resolve(p.sort(i))}}),f.promise}var h={runSearch:e,findNearbyObjects:g,getPlaceById:f},i=function(a,b){
return"SolarSystem"===b.get_constellation()&&"SolarSystem"!==a.get_constellation()?1:"SolarSystem"===a.get_constellation()&&"SolarSystem"!==b.get_constellation()?-1:b.get_studyImageset()&&!a.get_studyImageset()?1:a.get_studyImageset()&&!b.get_studyImageset()?-1:a.get_name()-b.get_name()};return h}]),wwt.app.factory("Skyball",["$rootScope",function(a){function b(a,b){if(b.isDirty||b.init){f.clearRect(0,0,100,100);var c=$("#skyball").height(),e=c/2,g=new d(.71*c,.71*c),h=new d(.71*c,.71*c),i=[],j=Math.PI/180,k=0,l=$("body").height(),m=$("body").width(),n=[wwtlib.WWTControl.singleton.getCoordinatesForScreenPoint(0,0),wwtlib.WWTControl.singleton.getCoordinatesForScreenPoint(m,0),wwtlib.WWTControl.singleton.getCoordinatesForScreenPoint(m,l),wwtlib.WWTControl.singleton.getCoordinatesForScreenPoint(0,l)],o=[];$.each(n,function(a,b){o[a]=wwtlib.Coordinates.fromRaDec(b.x,b.y)});for(var p=0;4>p;p++)i[p]=new d,i[p].x=g.x-Math.cos((o[p].get_RA()+6)/12*180*j)*Math.cos(o[p].get_lat()*j)*e,i[p].y=g.y-Math.sin(o[p].get_lat()*j)*e,k+=Math.sin((o[p].get_RA()+6)/12*180*j)*Math.cos(o[p].get_lat()*j)*e,f.beginPath(),f.lineWidth="1",f.moveTo(h.x,h.y),f.lineTo(i[p].x,i[p].y),f.closePath(),f.stroke();f.beginPath(),f.lineWidth="1",f.strokeStyle="yellow",$.each(i,function(a,b){0===p?f.moveTo(b.x,b.y):f.lineTo(b.x,b.y)}),f.closePath(),f.fillStyle=k/4>0?"rgba(255,255,0,.9)":"rgba(255,255,0,.5)",f.fill(),f.stroke()}}function c(){if(!$("#skyball").length)return void setTimeout(c,300);var d=$("#skyball").hasClass("mobile");e=$("<canvas></canvas>").css({position:"absolute",top:d?-5:-9,left:d?-9:-14,height:137,width:307}),$("#skyball").append(e),f=e.get(0).getContext("2d"),a.$on("viewportchange",b),b(null,{isDirty:!0})}function d(a,b){this.x=a,this.y=b}var e,f,g={init:c};return g}]),wwt.app.factory("HashManager",["$rootScope",function(a){function b(a,b,c,e){isNaN(b)&&(b=b.replace(/\s/g,"_"));var f="",h=c?g.substr(2):location.hash.substr(2);if(e)f=a+"="+b;else if(d(a,c)){var i=h.split("&");i.length>1?$.each(i,function(c,d){var e=d.split("=");c>0&&(f+="&"),f+=e[0]==a?e[0]+"="+b:d}):h.split("=")[0]==a&&(f+=a+"="+b)}else f=h.length>2?h+"&"+a+"="+b:a+"="+b;return f=f.replace(/&&/g,"&"),c?g="#/"+f:location.href="#/"+f,location.href.split("#")[0]+"#/"+f}function c(a,b){var c="",e=b?g.substr(2):location.hash.substr(2);if(d(a,b)){var f=e.split("&");f.length>1?$.each(f,function(b,d){var e=d.split("=");b>0&&(c+="&"),e[0]!=a&&(c+=d)}):e.split("=")[0]==a&&(c+="")}else c=e;return c=c.replace(/&&/g,"&"),b?g="#/"+c:location.href="#/"+c,location.href.split("#")[0]+"#/"+c}function d(a,b){return e(b)[a]}function e(a,b){var c={},d=b?b:a?g.substr(2):location.hash.substr(2);if(d.length>2&&-1!=d.indexOf("=")){var e=d.split("&");e.length>0&&$.each(e,function(a,b){if(-1!=b.indexOf("=")&&b.length>2){var d=b.split("=");c[d[0].replace(/_/g," ")]=d[1].replace(/_/g," ")}})}return c}var f={setHashVal:b,getHashVal:d,removeHashVal:c,getHashObject:e},g="#/",h=function(b){setTimeout(function(){a.$broadcast("hashChange",e())},10)};return window.onhashchange=h,f}]),wwt.app.factory("MediaFile",["$q",function(a){function b(a){return{url:a.url,key:a.key,db:"touredit",size:a.size,filename:a.name}}function c(){var a=localStorage.getItem("tourMedia");return a&&(j=JSON.parse(a)),j}function d(){var b=a.defer(),c=[];return j.forEach(function(a){c.push(g(a.url,!0))}),a.all(c).then(function(a){var c=document.implementation.createDocument(null,"FileCabinet");c.documentElement.setAttribute("HeaderSize","0x00000000");var d=c.createElement("Files");c.documentElement.appendChild(d);var f=0,g=new ArrayBuffer;a.forEach(function(a,b){var e=c.createElement("File");e.setAttribute("Name",j[b].filename),e.setAttribute("Url",j[b].url),e.setAttribute("Offset",f),e.setAttribute("Size",a.length),d.appendChild(e),f+=a.byteLength,g=l(g,a)});var i=new XMLSerializer,k="<?xml version='1.0' encoding='UTF-8'?>"+i.serializeToString(c),m=k.length.toString(16),n="0x00000000".substr(0,10-m.length)+m,o=l(h(k.replace("0x00000000",n)),g);g=k=null;var p=new Blob([o],{type:"application/wtt"});e("wtt",p).then(function(a){b.resolve(a)})}),b.promise}function e(c,d,e){var f=a.defer(),g=["music","voiceOver","wtt","image"],h=indexedDB.open("touredit");return h.onupgradeneeded=function(){var a=h.result;a.createObjectStore("files")},h.onsuccess=function(){var a=h.result,e=g.indexOf(c);2===e&&(e+=k,k++);var i=a.transaction("files","readwrite"),l=i.objectStore("files"),m=function(){var a=l.put(d,e);a.onsuccess=n},n=function(){var a=l.get(e);a.onsuccess=function(c){var d=a.result,g=URL.createObjectURL(d),h=b({url:g,key:e,size:d.size,name:d.name});f.resolve(h),j[e]=h,localStorage.setItem("tourMedia",JSON.stringify(j))}};m()},f.promise}function f(b){var c=a.defer(),d=b||"touredit",e=indexedDB.deleteDatabase(d);return e.onupgradeneeded=function(){c.reject("upgradeneeded")},e.onsuccess=c.resolve,e.onerror=c.reject,e.onblocked=c.reject,c.promise}function g(b,c,d){var e=a.defer();console.time("get binary string");var f=new XMLHttpRequest;return f.open("GET",b,!0),f.onload=function(){if(d)e.resolve(this.response);else if(c){for(var a=new Uint8Array(this.response),b=0,g=a.length;g>b;++b)a[b]=this.response[b];e.resolve(a)}else e.resolve(f.responseText);console.timeEnd("get binary data")},c?f.responseType="arraybuffer":f.overrideMimeType("text/plain; charset=x-user-defined"),f.send(null),e.promise}function h(a){for(var b=new ArrayBuffer(2*a.length),c=new Uint16Array(b),d=0,e=a.length;e>d;d++)c[d]=a.charCodeAt(d);return b}var i={getTourProgress:c,addTourMedia:e,flushStore:f,getBinaryData:g,saveTour:d},j=[],k=0,l=function(a,b){var c=new Uint8Array(a.byteLength+b.byteLength);return c.set(new Uint8Array(a),0),c.set(new Uint8Array(b),a.byteLength),c.buffer};return i}]),wwt.app.factory("Places",["$http","$q","$timeout","Util",function(a,b,c,d){function e(){var a=b.defer();return s.then(function(b){m=b,$.each(b,function(a,b){b.guid=b.get_name(),b.get_thumbnailUrl&&p(b)}),q(b),a.resolve(l.get_children())}),a.promise}function f(a){var c=b.defer();return a.childLoadCallback(function(){var b=a.get_children();$.each(b,function(b,c){c.guid=a.guid+"."+(c.get_isFolder()?c.get_name():b),c.get_thumbnailUrl&&p(c)}),c.resolve(q(b))}),c.promise}function g(){var a=b.defer();return e().then(function(b){f(b[1]).then(function(b){a.resolve(b.slice(1))})}),a.promise}function h(a){var c=b.defer();n||(n=wwt.wc.createFolder(),n.set_name("Open Collections"),n.guid="f0",l.addChildFolder(n));var d=wwt.wc.createFolder();return d.loadFromUrl(a,function(){d.url=a,n.addChildFolder(d),""==d.get_name()?c.resolve(d.get_children()):c.resolve(d)}),c.promise}function i(){var a=wwt.wc.createFolder();a.set_name("New VAMP Feeds"),a.guid="0v0",a.set_url("http://www.worldwidetelescope.org/wwtweb/catalog.aspx?W=vampfeeds"),l.addChildFolder(a)}function j(a,c){var d=b.defer();n||(n=wwt.wc.createFolder(),n.set_name("Open Collections"),l.addChildFolder(n));var e=wwt.wc.createFolder();e.set_name("Imported image");var g=-1!=a.indexOf("%2F%2F")?a:encodeURIComponent(a);return c&&(g+=c),e.loadFromUrl("http://www.worldwidetelescope.org/WWTWeb/TileImage.aspx?imageurl="+g,function(){0!=e.get_children()[0].get_RA()||0!=e.get_children()[0].get_dec()?(n.addChildFolder(e),f(e).then(function(a){""==e.get_name()?d.resolve(e.get_children()):d.resolve(e)})):d.resolve(!1)}),d.promise}function k(a,b){var c=null;return a=a.replace(/_/g," "),$.each(b,function(b,d){d.guid===a&&(c=d)}),c}var l,m,n,o={getRoot:e,getSolarSystemPlaces:g,getChildren:f,openCollection:h,importImage:j,findChildById:k},p=function(a){a.thumb=a.get_thumbnailUrl().replace("wwtstaging.azurewebsites.net/Content/Images/","wwtweb.blob.core.windows.net/images/").replace("www.worldwidetelescope.org/Content/Images/","wwtweb.blob.core.windows.net/images/").replace("worldwidetelescope.org/Content/Images/","wwtweb.blob.core.windows.net/images/")},q=function(a){return $.each(a,function(a,b){try{"function"==typeof b.get_type&&(b.isPlanet=1===b.get_type(),b.isFGImage=2===b.get_type()&&"function"==typeof b.get_camParams),"function"==typeof b.get_dataSetType&&(b.isEarth=0===b.get_dataSetType(),b.isPanorama=3===b.get_dataSetType(),b.isSurvey=2===b.get_dataSetType(),b.isPlanet=1===b.get_dataSetType())}catch(c){d.log(b,c)}}),a},r=function(){function a(){return wwt.wc?(l=wwt.wc.createFolder(),void l.loadFromUrl("http://www.worldwidetelescope.org/wwtweb/catalog.aspx?W=ExploreRoot",function(){var a;null!=d.getQSParam("wtml")?(n=wwt.wc.createFolder(),n.set_name("Open Collections"),a=wwt.wc.createFolder(),a.loadFromUrl(d.getQSParam("wtml"),function(){a.get_children(),n.addChildFolder(a),l.addChildFolder(n),i(),c.resolve(l.get_children())})):-1!==location.href.indexOf("?image=")?(i(),j(location.href.split("?image=")[1]).then(function(a){c.resolve(l.get_children())})):(i(),c.resolve(l.get_children()))})):void setTimeout(a,333)}var c=b.defer();return a(),c.promise},s=r();return o}]),wwt.app.factory("Tours",["$rootScope","$http","$q","$timeout","Util",function(a,b,c,d,e){function f(a){return m[a.toLowerCase()]}function g(a){if(!a)return null;var b=[];return $.each(a.split(";"),function(a,c){var d=f(c);d&&b.push(d)}),a.length>1?b:null}function h(){var a=c.defer();return p.then(function(){k=j.get_children(),a.resolve(n(k)),$.each(k,function(a,b){var c=b.get_children();$.each(c,function(a,b){b.get_isTour()&&(m[b.id.toLowerCase()]=b)})})}),a.promise}function i(a){var b=c.defer();return a.childLoadCallback(function(){b.resolve(n(a.get_children()))}),b.promise}var j,k,l={getRoot:h,getChildren:i,getTourById:f,getToursById:g},m={},n=function(a){return $.each(a,function(a,b){try{b.name=b.get_name(),b.thumb=b.get_thumbnailUrl(),b.isFolder=b.get_isFolder()}catch(c){e.log(b,c)}}),a},o=function(){var a=c.defer();j=wwt.wc.createFolder();var b="gettours_webclient.xml";return j.loadFromUrl(b,function(){a.resolve(j.get_children())}),a.promise},p=o();return l}]),wwt.app.factory("SearchData",["$http","$q","$timeout","Places","Util",function(a,b,c,d,e){function f(){var a=b.defer();return j.then(function(){a.resolve(i)}),a.promise}function g(){var a=b.defer();return j.then(function(){a.resolve(l)}),a.promise}function h(a){var c=b.defer();return $.ajax({url:a}).done(function(){var a=$($.parseXML(arguments[0]));a.find("Place").each(function(a,b){b=$(b);var c,d=parseFloat(b.attr("RA")),f=parseFloat(b.attr("Dec"));if(0!==d||0!==f){c=wwtlib.Constellations.containment.findConstellationForPoint(d,f);var g=b.find("ImageSet").length?b.find("ImageSet"):null,h=wwtlib.Place.create(b.attr("Name"),f,d,b.attr("DataSetType"),c,g?e.getImageSetType(g.attr("DataSetType")):2,parseFloat(b.find("ZoomLevel")));null!=g&&(o++,h.set_studyImageset(wwtlib.Imageset.create(g.attr("Name"),g.attr("Url"),e.getImageSetType(g.attr("DataSetType")),g.attr("BandPass"),wwtlib.ProjectionType[g.attr("Projection").toLowerCase()],o,parseInt(g.attr("BaseTileLevel")),parseInt(g.attr("TileLevels")),null,parseFloat(g.attr("BaseDegreesPerTile")),g.attr("FileType"),"True"===g.attr("BottomsUp"),"",parseFloat(g.attr("CenterX")),parseFloat(g.attr("CenterY")),parseFloat(g.attr("Rotation")),!0,g.find("ThumbnailUrl").text(),!1,!1,parseFloat(g.attr("WidthFactor")),parseFloat(g.attr("OffsetX")),parseFloat(g.attr("OffsetY")),g.find("Credits").text(),g.find("CreditsUrl").text(),"","",0,null))),q(h);var i=m.indexOf(c),j=wwt.searchData.Constellations[i].places;h.guid=i+"."+j.length,j.push(h)}}),c.resolve(!0)}),c.promise}var i,j,k={getData:f,getIndex:g,importWtml:h},l={},m=[],n=b.defer(),o=100,p=function(){if(wwt.searchData){wwt.searchDataIndexed=[],i=wwt.searchData;var a=new Date;$.each(i.Constellations,function(a,b){m[a]=b.name,$.each(b.places,function(c,d){var e,f=d.fgi;f&&(o++,e=wwtlib.Imageset.create(f.n,f.u,f.dt||2,f.bp,f.pr,o,f.bl,f.lv,null,f.bd,"",f.bu,f.q,f.cX,f.cY,f.r,!0,f.tu,f.ds,!1,f.wf,f.oX,f.oY,f.ct,f.cu,"","",0,null));var g=wwtlib.Place.create(d.n,d.d,d.r,d.c,b.name,f?f.dt:2,d.z);e&&g.set_studyImageset(e),"SolarSystem"===b.name&&$.each(g,function(a,b){ss.canCast(b,wwtlib.CameraParameters)&&(b.target=wwtlib.SolarSystemObjects.undefined)}),g.guid=a+"."+c,b.places[c]=g,q(g)})});var b=new Date;e.log("parsed places in "+(b.valueOf()-a.valueOf())+"ms",i),h("Wise.wtml").then(function(){console.log("wise loaded"),h("Hubble.wtml").then(function(){console.log("hubble loaded"),h("ESO.wtml").then(function(){console.log("eso loaded"),h("Chandra.wtml").then(function(){console.log("chandra loaded")})})}),n.resolve(i)})}else setTimeout(p,333);return n.promise},q=function(a){var b=function(a,b){var c=a.charAt(0).toLowerCase();if("'"===c&&(c=a.charAt(1).toLowerCase()),l[c])l[c][l[c].length-1]!==b&&(l[c].push(b),wwt.searchDataIndexed=l);else try{wwt.searchDataIndexed[c]=l[c]=[b]}catch(d){console.error(d)}};$.each(a.get_names(),function(c,d){if(-1!==d.indexOf(" ")){var e=d.split(" ");$.each(e,function(c,d){b(d,a)})}else d.charAt(0)&&b(d,a)})};return j=p(),k}]),wwt.app.factory("Astrometry",["$http","$q","$timeout","Util",function(a,b,c,d){function e(){j(n.connecting);var a={};a.apikey="mxzoqrhqsvkwtybb";var b=encodeURIComponent(JSON.stringify(a));$.ajax({url:"http://nova.astrometry.net/api/login",type:"POST",data:"request-json="+b,dataType:"json",crossDomain:!0}).done(function(a){o=a.session,t=null,j(n.connected),f()}).fail(function(a,b,c){t=c,j(n.connectFail)})}function f(){j(n.uploading);var a={url:k,session:o},b=encodeURIComponent(JSON.stringify(a));$.ajax({url:"http://supernova.astrometry.net/api/url_upload",type:"POST",data:"request-json="+b,dataType:"json",crossDomain:!0}).done(function(a){t=null,p=a.subid,j(n.uploadSuccess),g()}).fail(function(a,b,c){t=c,j(n.uploadFail)})}function g(){j(n.statusCheck),$.ajax({url:"http://supernova.astrometry.net/api/submissions/"+p,type:"GET",dataType:"json",crossDomain:!0}).done(function(a){$.each(a.jobs,function(a,b){null!=b&&(q=b)}),q?(j(n.jobFound),h()):setTimeout(g,2e3)}).fail(function(a,b,c){t=c,j(n.statusCheckFail)})}function h(){$.ajax({url:"http://supernova.astrometry.net/api/jobs/"+q,type:"GET",dataType:"json",crossDomain:!0}).done(function(a){return s=a.status,-1!=s.indexOf("fail")?void j(n.jobFail):void("success"!=a.status?(u&&(r={},r.ra=202.45355674088898,r.dec=47.20018130592933,r.rotation=122.97953942448784,r.scale=.3413275776344843,r.parity=1,j(n.jobSuccess)),j(n.jobStatus),window.setTimeout(h,5e3)):i())}).fail(function(a,b,c){t=c,j(n.jobFail)})}function i(){$.ajax({url:"http://supernova.astrometry.net/api/jobs/"+q+"/calibration",type:"GET",dataType:"json",crossDomain:!0}).done(function(a){r={},r.ra=a.ra,r.dec=a.dec,r.rotation=a.orientation,r.scale=a.pixscale,r.parity=a.parity,r.radius=a.radius,j(n.jobSuccess)}).fail(function(a,b,c){t=c,j(n.calibrationFail)})}function j(a){var b={};b.sessionId=o,b.submissionId=p,b.jobId=q,b.calibration=r,b.jobStatus=s,b.errorData=t,$.each(n,function(c,d){d===a&&(b.status=c,b.message=d)}),l(b)}var k,l,m={submitImage:function(a,b,c){b&&(l=b),k=a,o=null,p=null,q=null,u=c,e()}},n={connecting:"Connecting",connected:"Connect Success",connectFail:"Connection Failed",uploading:"Uploading Image",uploadSuccess:"Upload Success",uploadFail:"Upload Failed",statusCheck:"Checking Status",statusCheckFail:"Status Check Failed",jobFound:"Job Found",jobStatusCheck:"Checking Job Status",jobFail:"Could Not Resolve Image",jobStatus:"Solving Image",jobSuccess:"Job Succeeded",calibrationFail:"Calibration Results Failed"},o=null,p=null,q=null,r=null,s=null,t=null,u=!1;return m}]),wwt.app.factory("Community",["$http","$q","$timeout","Util",function(a,b,c,d){function e(){var a=b.defer();return k.then(function(b){h=b,$.each(b,function(a,b){b.get_thumbnailUrl&&(b.thumb=b.get_thumbnailUrl().replace("http://wwtstaging.azurewebsites.net/Content/Images/","https://wwtweb.blob.core.windows.net/images/"))}),a.resolve(b)}),a.promise}function f(a){var c=b.defer();return a.childLoadCallback(function(){var b=a.get_children();$.each(b,function(b,c){c.guid=a.guid+"."+(c.get_isFolder()?c.get_name():b)}),c.resolve(transformData(b))}),c.promise}var g,h,i={getRoot:e,getChildren:f},j=function(){function a(){return wwt.wc?(g=wwt.wc.createFolder(),void g.loadFromUrl("http://worldwidetelescope.org/Resource/Service/Payload",function(){c.resolve(g.get_children())})):void setTimeout(a,333)}var c=b.defer();return a(),c.promise},k=j();return i}]),wwt.controllers.controller("ContextPanelController",["$scope","$rootScope","$timeout","Util","SearchUtil","ThumbList",function(a,b,c,d,e,f){function g(){e.findNearbyObjects({lookAt:a.lookAt,singleton:b.singleton}).then(function(b){a.currentPage=0,$("body").append($("#researchMenu")),a.collection=b,d.isMobile&&a.setNBO(a.collection),j(a.collection)})}var h=new Date,i=function(){f.init(a,"context"),a.placesInCone=[],a.scrollDepth=40,b.$on("viewportchange",function(a,b){(!b.isDirty&&!b.init||(new Date).valueOf()-h.valueOf()>2e3)&&(g(),h=new Date)}),a.$watch("lookAt",g)};a.clickThumb=function(b){f.clickThumb(b,a)},a.hoverThumb=function(b){a.drawCircleOverPlace(b)};var j=function(){f.calcPageSize(a,!0)};$(window).on("resize",function(){a.currentPage=0,j()}),a.moveNboMenu=function(a){$("#nboMenuContainer"+a).append($("#researchMenu"))},a.showMenu=function(b,c){$(".popover-content .close-btn").click(),setTimeout(function(){$(".popover-content .close-btn").click(),$("#menuContainer"+c).find(".dropdown").addClass("open")},10),a.setMenuContextItem(b,!0)},a.preventClickBubble=function(a){a.stopImmediatePropagation()},a.goBack=function(){f.goBack(a)},a.goFwd=function(){f.goFwd(a)},i()}]),wwt.controllers.controller("MainController",["$scope","$rootScope","UILibrary","$q","AppState","Localization","$timeout","FinderScope","SearchData","Places","Util","HashManager","Skyball","SearchUtil","$modal","$element","$cookies",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(){var a=e.get("settings")||{};wwt.tourPlaying=b.tourPlaying=!1,b.landscapeMessage=!1,a.autoHideContext||$(".context-panel").fadeIn(800),a.autoHideTabs||$("#ribbon,.top-panel,.layer-manager").fadeIn(800),s.clearAnnotations()}var s,t=!0;a.lookTypes=["Earth","Planet","Sky","Panorama","SolarSystem"],a.lookAt="Sky",a.imagery=[[],[],[],[],[]],a.lookAtDropdownChanged=function(b){b&&(a.lookAt=b),setTimeout(function(){a.lookAtChanged(null,!0),a.setTrackingObj(!1)},1)},a.lookAtChanged=function(b,c,d,e){setTimeout(wwt.resize,120),e||k.resetCamera(!0),g(function(){$("#lstLookAt").length&&(a.lookAt=$("#lstLookAt option:selected").text()),""===a.lookAt&&(a.lookAt="Sky");var e=a.imagery[$.inArray(a.lookAt,a.lookTypes)];""!==e[0]&&e.splice(0,0,""),a.surveys=e;var f=!1;if("Mars"===b&&(b="Visible Imagery"),b&&$.each(e,function(){""===this||!this.get_name()||0!==this.get_name().indexOf(b)&&0!==b.indexOf(this.get_name())||(a.backgroundImagery=this,f=!0)}),!f){if(!t&&!c)return d?void 0:void(a.backgroundImagery=e[0]);setTimeout(function(){t=!1},500),g(function(){a.backgroundImagery=e[1],a.setSurveyBg()},123)}a.setSurveyBg()},100)},a.setLookAt=function(b,c,d,e){a.lookAt=b,a.lookAtChanged(c,!1,d,e),setTimeout(wwt.resize,1200)};var u=function(){s=b.ctl=wwtlib.WWTControl.initControlParam("WWTCanvas",e.get("WebGl")),window.Type&&Type.canCast&&(window.ss?window.ss.canCast=Type.canCast:window.ss={canCast:Type.canCast}),wwt.wc=s,wwt.resize(),s.add_ready(function(){var b=wwtlib.WWTControl.imageSets;a.surveys=[],$.each(b,function(){var b=this.get_dataSetType();this.name="Visible Imagery"===this.get_name()?"Mars":this.get_name(),2===b&&-1!==this.name.toLowerCase().indexOf("hipparcos")&&a.surveys.push(this);try{(2!==b||-1===this.name.toLowerCase().indexOf("hipparcos"))&&a.imagery[b].push(this)}catch(c){k.log(b,this)}}),a.backgroundImagery={name:"Digitized Sky Survey (Color)",get_name:function(){return"Digitized Sky Survey (Color)"}},a.lookAtChanged()}),s.settings.set_showConstellationBoundries(!1),k.resetCamera(!0),$(window).on("resize",wwt.resize),s.endInit(),b.singleton=wwtlib.WWTControl.singleton,x(),b.$on("hashChange",v),g(function(){var a=l.getHashObject();b.$broadcast("hashChange",a)},100)},v=function(b,c){var d=function(){s.gotoRaDecZoom(15*parseFloat(c.ra),parseFloat(c.dec),parseFloat(c.fov),!1)};if(c.place){var e=c.place;isNaN(parseInt(e.charAt(0)))||($("#loadingModal").modal("show"),n.getPlaceById(e).then(function(b){a.setForegroundImage(b),c.ra&&setTimeout(function(){if(d(),c.cf){$(".cross-fader a.btn").css("left",parseFloat(c.cf));for(var a=function(){s.setForegroundOpacity(parseFloat(c.cf))},b=1;6>b;b++)setTimeout(a,1e3*b)}},3333),$("#loadingModal").modal("hide")}))}else void 0!==c.ra&&d();c.lookAt?g(function(){a.setLookAt(c.lookAt,c.imagery),!c.ra||"Earth"!==c.lookAt&&"Planet"!==c.lookAt||setTimeout(d,2220)},2e3):c.imagery&&g(function(){a.setLookAt("Sky",c.imagery)},2e3)};a.initUI=function(){a.ribbon={tabs:[{label:"Explore",button:"rbnExplore",mobileLabel:"Explore Collections",mobileAction:function(){$("#exploreModalLink").click()},menu:{Open:{"Tour...":[a.openItem,"tour"],"Collection...":[a.openItem,"collection"],"Image...":[a.openItem,"image"]},sep1:null,"Tour WWT Features":[a.tourFeatures],"Show Welcome Tips":[J],"Show Finder (right click)":[a.showFinderScope],"WorldWide Telescope Home":[k.nav,"/home"],"Getting Started (Help)":[k.nav,"/Learn/"],"WorldWide Telescope Terms of Use":[k.nav,"/Terms"],"About WorldWide Telescope":[k.nav,"/About"]}},{label:"Guided Tours",button:"rbnTours",menu:{"Tour Home Page":[k.nav,"/Learn/Exploring#guidedtours"],"Music and other Tour Resources":[k.nav,"/Download/TourAssets"],sep2:null,"Create a New Tour...":[a.createNewTour]}},{label:"Search",button:"rbnSearch",menu:{"Search Now":[function(){g(function(){w("Search")})}]}},{label:"Communities",button:"rbnCommunities",menu:{"Search Communities":[k.nav,"/Community"]}},{label:"View",button:"rbnView",menu:{"Reset Camera":[k.resetCamera],"Share this View":[I],"Toggle Full Screen View (F11)":[k.toggleFullScreen],"Toggle Layer Manager":[a.toggleLayerManager]}},{label:"Settings",button:"rbnSettings",menu:{"Restore Defaults":[a.restoreDefaultSettings],"Product Support":[k.nav,"/Support/IssuesAndBugs"]}}]},k.getQSParam("ads")&&a.ribbon.tabs.push({label:"ADS",button:"rbnADS",menu:{"ADS Home Page":[function(){window.open("http://www.adsass.org/wwt")}]}}),a.activePanel=k.getQSParam("ads")?"ADS":"Explore",a.UITools=wwtlib.UiTools,a.Planets=wwtlib.Planets,b.$on("viewportchange",y),k.trackViewportChanges(),m.init(),$(window).on("keydown",function(a){187===a.which?s.zoom(.66666666666667):189===a.which&&s.zoom(1.5)})};var w=function(b){$("body").append($("#researchMenu")),a.expandTop(!1),a.activePanel=b},x=function(){var b=null!=k.getQSParam("ads"),c=$(".cross-fader a.btn").css("left",b?50:100);new wwt.Move({el:c,bounds:{x:[b?-50:-100,b?50:0],y:[0,0]},onstart:function(){c.addClass("moving")},onmove:function(){s.setForegroundOpacity(this.css.left)},oncomplete:function(){c.removeClass("moving")}});wwt.resize(),k.getQSParam("tourUrl")&&a.playTour(decodeURIComponent(k.getQSParam("tourUrl")))},y=function(c,d){if((d.isDirty||d.init)&&(b.viewport=d,a.coords=wwtlib.Coordinates.fromRaDec(d.RA,d.Dec),a.formatted={RA:k.formatHms(d.RA,!0),Dec:k.formatHms(d.Dec,!1,!0),Lat:k.formatHms(a.coords.get_lat(),!1,!1),Lng:k.formatHms(a.coords.get_lng(),!1,!1),Zoom:k.formatHms(d.Fov)},z(),d.init&&g(z,1200)),(d.isDirty||d.finderMove)&&A()){var e=h.scopeMove();e&&g(function(){a.scopePlace=e,a.drawCircleOverPlace(a.scopePlace)})}},z=function(){a.formatted.Constellation=a.constellations.fullNames?a.getFromEn(a.constellations.fullNames[b.singleton.constellation]):"..."},A=function(){return $(".finder-scope:visible").length?C=!0:C&&(C=!1,clearInterval(B)),C};a.$on("showFinderScope",function(){a.showFinderScope()}),a.$on("showContextMenu",function(){a.showContextMenu()});var B,C=!1,D=!0;a.showFinderScope=function(b){if("Sky"===a.lookAt){var c=$(".finder-scope");c.toggle(!c.prop("hidden")).css({top:b?b.pageY-88:180,left:b?b.pageX-301:250}),c.prop("hidden")&&(c.prop("hidden",!1),c.fadeIn(function(){if(!c.prop("movebound")){new wwt.Move({el:c,target:c.find(".moveable"),onmove:function(){D=!0}})}c.prop("movebound",!0)})),h.init(),b&&b.preventDefault(),B=setInterval(E,400),y(null,{finderMove:!0})}};var E=function(){A()&&D&&(y(null,{finderMove:!0}),D=!1)};a.initFinder=function(){i.getData().then(function(){var c=$(".finder-scope").prop("hidden",!0).fadeOut();c.find(".close, .close-btn").on("click",function(){c.fadeOut(function(){c.prop("hidden",!0)})}),a.showObject=function(a){b.singleton.gotoTarget(a),$(".finder-scope").hide()}})};var F=!1;a.setSurveyBg=function(c,d){if(c){"Mars"===c&&(c="Visible Imagery");var e=!1;if($.each(a.surveys,function(){!this.name||0!==this.name.indexOf(c)&&0!==c.indexOf(this.name)||(a.backgroundImagery=this,e=!0)}),!e)return a.backgroundImagery="",s.setBackgroundImageByName(c),void(d&&b.singleton.renderContext.set_backgroundImageset(d))}a.backgroundImagery&&"?"!==a.backgroundImagery&&s.setBackgroundImageByName(a.backgroundImagery.get_name()),"string"==typeof a.backgroundImagery||"3D Solar System View"!==a.backgroundImagery.get_name()||F||setTimeout(function(){var a=$(".planetary-scale .btn");new wwt.Move({el:a,bounds:{x:[0,66],y:[0,0]},onstart:function(){a.addClass("moving")},onmove:function(){s.settings.set_solarSystemScale(Math.max(1.5*this.css.left,1))},oncomplete:function(){a.removeClass("moving")}});F=!0},10)},a.setSurveyProperties=function(){a.propertyItem=a.backgroundImagery,a.propertyItem.isSurvey=!0},a.setActiveItem=function(b){a.activeItem=b,b.guid&&(a.shareUrl=l.setHashVal("place",b.guid,!0,!0)),b.get_studyImageset&&(a.activeItem.imageSet=b.get_studyImageset())},a.setForegroundImage=function(c){c.guid&&(a.shareUrl=l.setHashVal("place",c.guid,!0,!0)),k.isMobile&&($("#explorerModal").modal("hide"),$("#nboModal").modal("hide"));var d=k.getImageset(c);return d&&!c.isEarth&&wwtlib.WWTControl.singleton.renderContext.set_foregroundImageset(d),a.setTrackingObj(c),!c.isSurvey&&ss.canCast(c,wwtlib.Place)?($(".finder-scope").hide(),void b.singleton.gotoTarget(c,k.getIsPlanet(c),!1,!0)):void(c.isEarth?b.singleton.renderContext.set_backgroundImageset(d):s.setForegroundImageByName(d.get_name()))},a.setBackgroundImage=function(a){var c=k.getImageset(a);c&&b.singleton.renderContext.set_backgroundImageset(c),a.isSurvey||b.singleton.gotoTarget(a,!1,!1,!0)},a.menuClick=function(b){a.keepMenu=!0;var c=$("#topMenu");c.html(""),$.each(b,function(a,b){var d;if(0===a.indexOf("sep"))d=$('<li class="divider" role="presentation"></li>');else if(d=$('<li><a href="javascript:void(0)"></a></li>'),d.find("a").text(f.getFromEn(a)),$.isPlainObject(b)){d.addClass("dropdown-submenu").find("a").attr("tab-index",-1);var e=$("<ul class=dropdown-menu></ul>");d.append(e),$.each(b,function(a,b){var c=$('<li><a href="javascript:void(0)"></a></li>');c.find("a").on("click",function(){b[0](b[1])}).data("action",b).text(f.getFromEn(a)),e.append(c)})}else d.find("a").on("click",function(){b[0](b[1])}).data("action",b);c.append(d)});var d=$("#tabMenu"+this.$index);c.css({top:d.offset().top+d.height(),left:d.offset().left}).show(),setTimeout(function(){$(document).on("click",G),a.keepMenu=!1},123)};var G=function(){a.keepMenu||($("#topMenu").hide(),$(document).off("click",G))};a.tabClick=function(c){b.editingTour,$("body").append($("#researchMenu")),a.expandTop(!1),a.activePanel=c.label,e.set("activePanel",c.label)},a.openItem=function(b){a.openType=b,"collection"===b&&a.tabClick(a.ribbon.tabs[0]),$("#openModal").modal("show")},a.playTour=function(c){console.log(encodeURIComponent(c)),$(".finder-scope").hide(),wwtlib.WWTControl.singleton.playTour(c),wwt.tourPlaying=b.tourPlaying=!0,b.tourPaused=!1,wwt.wc.add_tourEnded(r),wwt.wc.add_tourReady(function(){$("#ribbon,.top-panel,.context-panel,.layer-manager").fadeOut(800,function(){a.$applyAsync(function(){a.activeItem={label:"currentTour"},a.activePanel="currentTour",a.ribbon.tabs[1].menu["Edit Tour"]=[a.editTour]})})})},a.editTour=function(){b.$applyAsync(function(){b.editingTour=!0})},b.finishTour=function(){b.editingTour=!1,delete a.ribbon.tabs[1].menu["Edit Tour"],b.editingTour=!1,b.tourPlaying=!1,wwtlib.WWTControl.singleton.stopCurrentTour(),a.activePanel="Guided Tours",$("#ribbon, .top-panel, .context-panel, .layer-manager").fadeIn(400)},a.createNewTour=function(){a.$applyAsync(function(){b.currentTour=wwtlib.WWTControl.singleton.createTour("New Tour"),a.activeItem={label:"currentTour"},a.activePanel="currentTour"})};var H=o({contentTemplate:"views/popovers/shareplace.html",show:!1,scope:a}),I=function(){H.$promise.then(H.show)};a.restoreDefaultSettings=function(){b.$broadcast("restoreDefaults")};var J=function(){$("#introModal").modal("show")};a.selectedLanguage="EN",a.setLanguageCode=function(c){e.set("language",c),g(function(){a.selectedLanguage!==c&&(a.selectedLanguage=c,a.languageCode=c)},200),b.languagePromise=f.setLanguage(c)},a.setLanguageCode(e.get("language")||"EN"),a.locString=function(a){var c=d.defer();return b.languagePromise.then(function(){K[a]=f.getString(a),c.resolve(K[a])}),c.promise};var K=[],L=0;a.getFromEn=function(c){L++;var e=c+a.selectedLanguage;if("EN"===a.selectedLanguage&&(K[e]=c),K[e])return K[e];var g=d.defer();return b.languagePromise.then(function(){"EN"==a.selectedLanguage?K[e]=c:K[e]=f.getFromEn(c),g.resolve(K[e])}),g.promise},f.getAvailableLanguages().then(function(b){a.availableLanguages=b}),b.loc={na:"",neverRises:""},b.languagePromise.then(function(c){if(b.na=f.getFromEn("n/a"),b.neverRises=f.getFromEn("Never Rises"),a.hideIntroModal=e.get("hideIntroModalv2"),!a.hideIntroModal&&!a.loadingUrlPlace){if(localStorage.getItem("login")){var d=(new Date).valueOf(),g=parseInt(localStorage.getItem("login"));if(33333>d-g)return}setTimeout(J,1200)}}),a.formatHms=function(a,b,c,d){return k.formatHms(a,b,c,d)},a.formatDecimalHours=function(a,b){var c=wwtlib.UiTools.formatDecimalHours(a).split(":");return parseInt(c[0])<10&&(c[0]="0"+c[0]),parseInt(c[1])<10&&(c[1]="0"+c[1]),c.join(" : ")},b.showTrackingString=function(){return a.trackingObj&&$(window).width()>1159},b.showCrossfader=function(){var b=!1;if("ADS"===a.activePanel)return!0;try{"Sky"===a.lookAt&&a.trackingObj&&null!=k.getImageset(a.trackingObj)&&($(window).width()>800||k.isMobile)&&(b=!0)}catch(c){b=!1}return b},a.hideIntroModalChange=function(a){e.set("hideIntroModalv2",a)},a.iswebclientHome="home"!==q.get("homepage"),a.homePrefChange=function(a){q.remove("homepage"),a?q.put("homepage","webclient",{expires:new Date(2050,1,1),path:"/"}):q.put("homepage","home",{expires:new Date(2050,1,1),path:"/"})},a.setMenuContextItem=function(b,c){a.menuContext=b,a.propertyItem=b,a.propertyItem.isExploreTab=c},a.showProperties=function(){$(".popover-content .close-btn").click(),$(".dropdown.open #researchMenu, .dropup.open #researchMenu").closest(".thumbwrap").find(".thumb-popover").click()},a.setTrackingObj=function(b){a.trackingObj=b,null===a.trackingObj&&l.removeHashVal("place",!0)},a.showMobileTracking=function(){return a.trackingObj&&a.trackingObj.get_name&&!a.tourPlaying&&"Earth"!==a.lookAt&&"Planet"!==a.lookAt&&"Panorama"!==a.lookAt},a.displayXFader=function(){return"Sky"===a.lookAt&&a.trackingObj&&!a.tourPlaying&&(null!=a.trackingObj.get_backgroundImageset()||null!=a.trackingObj.get_studyImageset())},a.gotoConstellation=function(a){b.singleton.gotoTarget(wwtlib.Constellations.constellationCentroids[a],!1,!1,!0)},a.drawCircleOverPlace=function(a){k.drawCircleOverPlace(a)},a.clearAnnotations=function(){s.clearAnnotations()},a.topExpanded=!1,a.expandTop=function(b,c){a.topExpanded=b,a.expandedPanel=c},a.tourFeatures=function(){a.loadingTour=!0,setTimeout(function(){$("#introStartButton").click()},3),setTimeout(function(){$("#btnCloseIntro").click(),a.loadingTour=!1},1e3)},u(),a.constellations=wwtlib.Constellations,a.nbo=[],a.setNBO=function(b){a.nbo=b,a.nboCount=b.length,a.isLoading&&(a.isLoading=!1)},a.hideMenu=function(){$(".navbar-collapse.in").removeClass("in").addClass("collapse")},a.showNbo=function(){$("#nboModalLink").click(),a.hideMenu()},a.isLoading=!0,a.fovClass=function(){return"Planet"===a.lookAt||"Panorama"===a.lookAt||"Earth"===a.lookAt?"hide":"SolarSystem"===a.lookAt?"solar-system-mode fov-panel":"fov-panel";
},a.contextPanelClass=function(){var c="Planet"===a.lookAt||"Panorama"===a.lookAt||"Earth"===a.lookAt?"context-panel compressed":"context-panel";return b.tourPlaying&&(c+=" hide"),c},a.contextPagerRight=function(){return a.showTrackingString()?0:50},k.getQSParam("playTour")&&a.playTour(decodeURIComponent(k.getQSParam("playTour")))}]),wwt.app.controller("IntroController",["$rootScope","$scope","$timeout","Localization",function(a,b,c,d){b.completed=function(){e()},b.exit=function(){e()};var e=function(){$("#WorldWideTelescopeControlHost").css("zIndex",0),$(".layer-manager").css("zIndex",1)};b.beforeChange=function(){var a=b.options.steps[this._currentStep],c=this._currentStep+1;try{a.before()}catch(d){setTimeout(function(){a.before()},10)}setTimeout(function(){$(".introjs-nextbutton").addClass("disabled").prop("disabled",!0)},100),setTimeout(function(){$(".introjs-nextbutton").removeClass("disabled").prop("disabled",!1),$(".introjs-tooltipbuttons small").text("(Step "+c+" of "+(b.options.steps.length-1)+")")},a.enableMs?a.enableMs:1e3)},b.afterChange=function(){$(".introjs-tooltipbuttons small").remove();var a=$("<small class=pull-left></small>").text("(Preparing step "+(this._currentStep+1)+" of "+(b.options.steps.length-1)+")").css({position:"relative",top:5,opacity:.8});$(".introjs-tooltipbuttons").append(a)};var f=function(a){return d.getFromEn(a)},g=function(){setTimeout(function(){$("#rbnExplore").click()},500),$("#WorldWideTelescopeControlHost").css("zIndex",-2),$(".layer-manager").css("zIndex",-1),$(".introjs-nextbutton").hide()};c(function(){b.options={steps:[{element:$("#rbnExplore").parent().parent()[0],intro:f("Each button has two parts.  Clicking on the top part with the label will reveal the associated panel."),position:"bottom",before:g},{element:$("#rbnExplore").parent().parent()[0],intro:f("Clicking the arrow at the bottom of the button reveals a drop-down menu."),position:"bottom",before:function(){$("#tabMenu0").addClass("hover").parent().addClass("hover").parent().addClass("hover").parent().addClass("hover")}},{element:$("#topPanel")[0],intro:f("Within the Explore panel, you can browse imagery organized into various collections."),position:"bottom",before:function(){$("#tabMenu0").removeClass("hover").parent().removeClass("hover").parent().removeClass("hover").parent().removeClass("hover")}},{element:$("#topPanel")[0],intro:f("Choose from different image collections, such as this one on Hubble Studies."),position:"bottom",before:function(){$($("#topPanel .thumbnail")[5]).addClass("hover"),setTimeout(function(){$($("#topPanel .thumbnail")[5]).click()},1)},enableMs:2e3},{element:$(".tn-expander")[0],intro:f("The arrow at the bottom of panel of thumbnails expands or collapses the panel."),position:"bottom",before:function(){$(".tn-expander").click()}},{element:$("#topPanel")[0],intro:f("Choose an item, such as the Sombrero Galaxy.  This moves the view to that location and overlays a foreground image from the Hubble Space Telescope on top of the all-sky background."),position:"bottom",before:function(){$($("#topPanel .thumbnail")[12]).addClass("hover"),setTimeout(function(){$($("#topPanel .thumbnail")[12]).click()},800)},enableMs:8e3},{element:$("#rbnTours").parent().parent()[0],intro:f("Guided Tours have been created to present particular topics by using WWT to show specific views of the sky and astronomical objects.  You can browse guided tours by clicking the Guided Tours button."),position:"bottom",before:function(){$("#rbnTours").click()}},{element:$("#topPanel")[0],intro:"Guided tours are grouped by category",position:"bottom",before:function(){$($("#topPanel .thumbnail")[2]).addClass("hover")}},{element:$("#topPanel")[0],intro:f("You can play a tour by clicking on the thumbnail.   Note, that most tours have music and narration so turn on your speakers! Please wait until this feature tour is complete before clicking a guided tour."),position:"bottom",before:function(){$($("#topPanel .thumbnail")[2]).removeClass("hover").click()}},{element:$("#rbnSearch").parent().parent()[0],intro:"The search panel enables you to search for objects in the sky by name or position.",position:"bottom",before:function(){$("#rbnSearch").click()}},{element:$("#topPanel")[0],intro:f("Lets search for M51. This shows a list of thumbnails in the search panel.  You can click on any to orient your view on the object."),position:"bottom",before:function(){var a=jQuery.Event("keypress");a.which=50,$("input").trigger(a),setTimeout(function(){$("#txtSearch").val("M"),$("#txtSearch").trigger(a)},300),setTimeout(function(){$("#txtSearch").val("M5"),$("#txtSearch").trigger(a)},1500),setTimeout(function(){$("#txtSearch").val("M51"),$("#txtSearch").trigger(a)},2500),setTimeout(function(){$($("#topPanel .thumbnail")[2]).addClass("hover").click()},3500)},enableMs:8e3},{element:$(".cross-fader").parent()[0],intro:f("If you have a foreground and background image showing, you can adjust the opacity of the foreground image with the Image Crossfade slider."),position:"top",before:function(){$(".finder-scope").prop("hidden",!0).fadeOut()}},{element:$("#topPanel")[0],intro:f("Clicking on the View tab brings up a panel that allows you to setup your viewing location and the time."),position:"bottom",before:function(){$("#rbnView").click()}},{element:$("#topPanel")[0],intro:f("The Settings panel allows you to customize various things, such as the language."),position:"bottom",before:function(){$("#rbnSettings").click()}},{element:null,intro:f("You can use your mouse wheel (or touchpad scrolling function) to zoom in and out. You can also type + or -"),position:"bottom",before:function(){setTimeout(function(){wwt.wc.zoom(.6667)},300),setTimeout(function(){wwt.wc.zoom(.6667)},1300),setTimeout(function(){wwt.wc.zoom(1.5)},2300),setTimeout(function(){wwt.wc.zoom(1.5)},3300)},enableMs:3500},{element:null,intro:f("You can move the View by left-clicking and dragging your mouse."),position:"bottom",before:function(){wwt.wc.gotoRaDecZoom(0,0,60,!0),setTimeout(function(){wwt.wc.gotoRaDecZoom(22,0,60)},1200),setTimeout(function(){wwt.wc.gotoRaDecZoom(0,0,60)},2200)},enableMs:4e3},{element:null,intro:f("You can rotate the view by holding the Control Key while you move your mouse."),position:"bottom",before:function(){wwtlib.WWTControl.singleton.renderContext.targetCamera.angle=-.3,wwtlib.WWTControl.singleton.renderContext.targetCamera.rotation=-.3,wwtlib.WWTControl.singleton.render(),setTimeout(function(){wwtlib.WWTControl.singleton.renderContext.targetCamera.angle=.3,wwtlib.WWTControl.singleton.renderContext.targetCamera.rotation=.3,wwtlib.WWTControl.singleton.render()},1100),setTimeout(function(){wwtlib.WWTControl.singleton.renderContext.targetCamera.angle=0,wwtlib.WWTControl.singleton.renderContext.targetCamera.rotation=0,wwtlib.WWTControl.singleton.render()},2200)},enableMs:2500},{element:$(".finder-scope")[0],intro:f("Right-clicking anywhere in the main view brings up a Finder Scope that allows you to investigate a specific object in more detail. The white circle shows the nearest object from the center of the crosshairs."),position:"right",before:function(){wwt.wc.gotoRaDecZoom(22,-11,60,!0),a.$broadcast("showFinderScope")}},{element:$("#lstLookAt")[0],intro:f("Near the bottom is a menu that controls what you are looking at.  You can look at the Sky, which is what you are looking at now."),position:"top",before:function(){$(".finder-scope").prop("hidden",!0).fadeOut()}},{element:$("#lstLookAt")[0],intro:f("You can also look at Earth, which brings up a 3D view of our planet as seen from space."),position:"top",before:function(){setTimeout(function(){$("#lstLookAt").val(0).trigger("change")},10),setTimeout(function(){wwt.wc.zoom(.3)},1200)},enableMs:1500},{element:$("#lstLookAt")[0],intro:f("You can look at Planets which shows you 3D views of other solar system worlds, such as the planet Mars."),position:"top",before:function(){$("#lstLookAt").val(1).trigger("change"),setTimeout(function(){wwt.wc.zoom(.3)},1200)},enableMs:2e3},{element:$("#lstLookAt")[0],intro:f("When looking at Panoramas you can explore various panoramic images, which are wrap-around images taken from the surface of Earth, Mars, and Earths Moon."),position:"top",before:function(){$("#lstLookAt").val(3).trigger("change")},enableMs:2e3},{element:$("#lstLookAt")[0],intro:f("You can also look at the SolarSystem, which shows a 3D view of our Solar System, the 3D views of planets and orbits."),position:"top",before:function(){$("#lstLookAt").val(4).trigger("change"),wwt.wc.gotoRaDecZoom(22,90,45)},enableMs:2e3},{element:$("#topPanel")[0],intro:f("When looking at SolarSystem, you can open the View tab and advance time forward many times faster than real-time to show the motion of the planets."),position:"bottom",before:function(){wwt.wc.gotoRaDecZoom(22,90,15),$("#rbnView").click();var a=0,b=function(){a++,setTimeout(function(){$("#btnFastFwd").click(),7>a&&b()},500)};setTimeout(b,1500)},enableMs:5e3},{element:$(".context-panel")[0],intro:f("The context panel at the bottom shows a list of objects with associated images that are in the main view."),position:"top",before:function(){$("#btnTimeNow").click(),$("#lstLookAt").val(2).trigger("change"),wwt.wc.gotoRaDecZoom(0,0,60)},enableMs:2e3},{element:$(".context-panel")[0],intro:f("When you move the view, the context panel updates the list of images in the view."),position:"top",before:function(){wwt.wc.gotoRaDecZoom(33,-11,30)}},{element:$(".context-panel")[0],intro:f("You can click on any thumbnail to move the main view to that location."),position:"top",before:function(){$($(".context-panel .thumbnail")[4]).addClass("hover").click()}},{element:$(".layer-manager")[0],intro:f("Additional information, such as grids and constellations, are available in the Layer Manager shown on the left."),position:"right",before:function(){}},{element:$("#btnToggleLayerMgr")[0],intro:f("You can hide and show the layer manager by clicking the Layer Manager button."),position:"right",before:function(){$(".introjs-nextbutton").hide()}},{element:null,intro:f("The tour is finished. You can play this tour anytime from the Welcome dialog. The Welcome dialog is available under the Explore menu. We hope you enjoy using WorldWide Telescope!")}],showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!0,nextLabel:'<strong>Next <i class="fa fa-arrow-right"></i></strong>',prevLabel:'<span><i class="fa fa-arrow-left"></i> Back</span>',skipLabel:"Exit Tour",doneLabel:"Close"}},3333)}]),wwt.controllers.controller("MobileNavController",["$rootScope","$scope","Util","$modal","Localization",function(a,b,c,d,e){b.showModal=function(a){b.hideMenu(),"object"==typeof a.modal?a.modal.$promise.then(a.modal.show):$(a.modal).modal("show")},a.languagePromise.then(function(){b.modalButtons=[{text:e.getFromEn("Explore"),icon:"fa-binoculars",modal:"#explorerModal"},{text:e.getFromEn("Tours"),icon:"fa-play",modal:d({contentTemplate:"views/modals/mobile-tours.html",show:!1,scope:b})},{text:e.getFromEn("Search"),icon:"fa-search",modal:d({contentTemplate:"views/modals/mobile-search.html",show:!1,scope:b,prefixEvent:"searchModal"})},{text:e.getFromEn("View"),icon:"fa-eye",modal:d({contentTemplate:"views/modals/mobile-view.html",show:!1,scope:b})},{text:e.getFromEn("Settings"),icon:"fa-gears",modal:d({contentTemplate:"views/modals/mobile-settings.html",show:!1,scope:b})},{text:e.getFromEn("Layers"),icon:"fa-align-left",modal:d({contentTemplate:"views/modals/mobile-layer-manager.html",show:!1,scope:b})}]}),b.gotoPage=function(a){b.hideMenu(),open(a)},b.resetCamera=function(){b.trackingObj=null,b.hideMenu(),c.resetCamera()},b.tabClick=function(a){b.hideMenu(),a.action()},b.hideMenu=function(){$(".navbar-collapse.in").removeClass("in").addClass("collapse")},b.menuAction=function(a){c.log(a)},b.$on("searchModal.show.before",function(){a.searchModal=!0}),b.$on("searchModal.hide",function(){a.searchModal=!1})}]),wwt.controllers.controller("LayerManagerController",["$scope","AppState","$timeout","Util",function(a,b,c,d){function e(a){this.name=a.name,this.checked=void 0===a.checked?!0:a.checked,this.children=a.children||[],this.action=a.action,this.collapsed=a.collapsed||!1,this.disabled=!1,a.v&&(this.v=a.v)}function f(a,b){$.each(b.children,f),j(b)}var g=5,h=[];a.initLayerManager=function(){return wwtlib.Constellations.abbreviations?($.each(wwtlib.Constellations.abbreviations,function(a,b){h.push(new e({name:a}))}),a.tree=b.get("layerManager"),a.tree&&a.tree.v&&a.tree.v===g||(a.tree=i(),b.set("layerManager",a.tree)),c(function(){f(0,a.tree)}),void wwt.resize()):void setTimeout(a.initLayerManager,333)};var i=function(){return new e({v:g,name:a.getFromEn("Sky"),action:"showSkyNode",children:[new e({name:a.getFromEn("Overlays"),action:"showSkyOverlays",children:[new e({name:a.getFromEn("Constellations"),action:"constellationsEnabled",children:[new e({name:a.getFromEn("Constellation Pictures"),action:"showConstellationPictures",checked:!1}),new e({name:a.getFromEn("Constellation Figures"),action:"showConstellationFigures"}),new e({name:a.getFromEn("Constellation Boundaries"),collapsed:!0,children:[new e({name:a.getFromEn("Focused Only"),action:"showConstellationSelection"})],action:"showConstellationBoundries"}),new e({name:a.getFromEn("Constellation Names"),checked:!1,action:"showConstellationLabels"})]}),new e({name:a.getFromEn("Grids"),action:"showSkyGrids",children:[new e({name:a.getFromEn("Equatorial Grid"),checked:!1,collapsed:!0,action:"showGrid",children:[new e({name:a.getFromEn("Axis Labels"),checked:!0,action:"showEquatorialGridText"})]}),new e({name:a.getFromEn("Galactic Grid"),checked:!1,collapsed:!0,action:"showGalacticGrid",children:[new e({name:a.getFromEn("Axis Labels"),checked:!0,action:"showGalacticGridText"})]}),new e({name:a.getFromEn("AltAz Grid"),checked:!1,collapsed:!0,action:"showAltAzGrid",children:[new e({name:a.getFromEn("Axis Labels"),checked:!0,action:"showAltAzGridText"})]}),new e({name:a.getFromEn("Ecliptic Grid"),checked:!1,collapsed:!0,children:[new e({name:a.getFromEn("Axis Labels"),checked:!0,action:"showEclipticGridText"})],action:"showEclipticGrid"}),new e({name:a.getFromEn("Ecliptic Overview"),checked:!0,collapsed:!0,action:"showEcliptic",children:[new e({name:a.getFromEn("Month Labels"),checked:!1,action:"showEclipticOverviewText"})]}),new e({name:a.getFromEn("Precession Chart"),checked:!1,action:"showPrecessionChart"})]})]}),new e({name:a.getFromEn("2d Sky"),checked:!0,action:"showSkyNode",children:[new e({name:a.getFromEn("Show Solar System"),checked:!0,action:"showSolarSystem"})]}),new e({name:a.getFromEn("3d Solar System"),checked:!0,action:"showSolarSystem",children:[new e({name:a.getFromEn("Milky Way (Dr. R. Hurt)"),checked:!0,action:"solarSystemMilkyWay"}),new e({name:a.getFromEn("Planets (NASA, ETAL)"),checked:!0,action:"solarSystemPlanets"}),new e({name:a.getFromEn("Planetary Orbits"),checked:!0,action:"solarSystemOrbits"}),new e({name:a.getFromEn("Lighting and Shadows"),checked:!0,action:"solarSystemLighting"})]})]})};a.nodeChange=function(c){b.set("layerManager",a.tree),j(c)};var j=function(a){if(!a.disabled&&a.action&&wwt.wc.settings["set_"+a.action]){var b=a.checked&&!a.disabled;wwt.wc.settings["set_"+a.action](b)}k(a)},k=function(a){a.children&&$.each(a.children,function(b,c){if(c.disabled=!a.checked||a.disabled,c.action&&wwt.wc.settings["set_"+c.action]){var d=c.checked&&!c.disabled;wwt.wc.settings["set_"+c.action](d)}k(c)})}}]),wwt.controllers.controller("ADSController",["$scope","Util","$timeout",function(a,b,c){function d(){var d=parseFloat(b.getQSParam("ra")||0),e=parseFloat(b.getQSParam("dec")||0),f=parseFloat(b.getQSParam("fov")||60),g=b.getQSParam("layer")||"allSources";"_512"!==g.slice(g.length-4)&&(g+="_512"),wwt.wc.setForegroundImageByName(g),$("#facet-list a").each(function(a,b){return $(b).attr("href")===g?(b.click(),void $("#foreground-lbl").text($(b).text())):void 0}),wwt.wc.setForegroundOpacity(50),wwt.wc.gotoRaDecZoom(d,e,f,!0),c(function(){a.fgImagery="All",a.bgImagery="WISE All Sky (Infrared)",a.bgChange(),a.setSurveyBg("WISE All Sky (Infrared)")},1300)}a.adsFilter="All";var e=["date-pre1800_512","date-1800_1850_512","date-1850_1900_512","date-1900_1910_512","date-1910_1920_512","date-1920_1930_512","date-1930_1940_512","date-1940_1945_512","date-1945_1950_512","date-1950_1955_512","date-1955_1960_512","date-1960_1965_512","date-1965_1970_512","date-1970_1975_512","date-1975_1980_512","date-1980_1985_512","date-1985_1990_512","date-1990_512","date-1991_512","date-1992_512","date-1993_512","date-1994_512","date-1995_512","date-1996_512","date-1997_512","date-1998_512","date-1999_512","date-2000_512","date-2001_512","date-2002_512","date-2003_512","date-2004_512","date-2005_512","date-2006_512","date-2007_512","date-2008_512","date-2009_512","date-2010_512","date-2011_512","date-2012_512","date-2013_512"],f=[{label:"GLIMPSE",name:"GLIMPSE/MIPSGAL"},{label:"All",name:"allSources_512"},{label:"WISE",name:"WISE All Sky (Infrared)"},{label:"X-ray",name:"X_512"},{label:"Ultraviolet",name:"UV_512"},{label:"Star",name:"Star_512"},{label:"Radio",name:"Radio_512"},{label:"Other",name:"Other_512"},{label:"Nebula",name:"Nebula_512"},{label:"",name:"lut_y"},{label:"",name:"lut_x"},{label:"Infrared",name:"Infrared_512"},{label:"HII regions",name:"HII-region_512"},{label:"Galaxy",name:"Galaxy_512"}];a.initAds=function(){wwt.wc.add_collectionLoaded(d),wwt.wc.loadImageCollection("adsass.wtml");var a=$(".year-slider a.btn");new wwt.Move({el:a,bounds:{x:[-55,45],y:[0,0]},onstart:function(){a.addClass("moving"),g()},onmove:function(){g()},oncomplete:function(){a.removeClass("moving")}})};var g=function(){c(function(){a.fgImagery="year";var b=$(".year-slider a.btn").position().left/100,c=e[Math.max(0,Math.round(b*e.length)-1)];a.year=c.split("ate-")[1].split("_512")[0].replace(/_/,"-"),wwt.wc.setForegroundImageByName(c),wwt.wc.setForegroundOpacity($(".cross-fader a.btn").position().left)})};a.bgChange=function(){a.setSurveyBg(a.bgImagery)},a.adsChange=function(){return"year"===a.fgImagery?void g():void $.each(f,function(b,c){c.label===a.fgImagery&&(wwt.wc.setForegroundImageByName(c.name),wwt.wc.setForegroundOpacity($(".cross-fader a.btn").position().left))})}}]),wwt.controllers.controller("ExploreController",["$scope","$rootScope","AppState","Places","$timeout","Util","ThumbList",function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n=1,o=[];b.$on("hashChange",function(b,c){c.place&&isNaN(parseInt(c.place.charAt(0)))&&(m=c,k=c.place,l=1,a.loadingUrlPlace=!0,$("#loadingModal").modal("show"),d.getRoot().then(function(){a.breadCrumb=i=[a.getFromEn("Collections")],$("body").append($("#researchMenu")),a.collection=h,q()}))}),a.initExploreView=function(b){g.init(a,"explore"),b||d.getRoot().then(function(b){$("body").append($("#researchMenu")),a.collection=h=b;var c=a.getFromEn("Collections");c.then?c.then(function(b){a.breadCrumb=i=[b]}):a.breadCrumb=i=[c],o=[b],s(),$.each(b,function(c,d){("Open Collections"===d.get_name()||"New VAMP Feeds"===d.get_name())&&(b.splice(0,0,b.splice(c,1)[0]),"Open Collections"===d.get_name()&&(j=!0,a.clickThumb(d)))})})};var p,q=function(){var c=k.split("."),f=c.slice(0,l).join("."),g=d.findChildById(f,a.collection);l<c.length?(l++,a.clickThumb(g,q)):e(function(){if(a.loadingUrlPlace=!1,a.clickThumb(g),$("#loadingModal").modal("hide"),m.ra){var c=-1!==m.place.toLowerCase().indexOf("hirise")?6666:3333;setTimeout(function(){b.ctl.gotoRaDecZoom(15*parseFloat(m.ra),parseFloat(m.dec),parseFloat(m.fov),!1)},c)}location.hash="/"},2222)},r=!1;a.$on("initExplorer",function(b,c){r||(p=c,a.initExploreView(),r=!0,setTimeout(function(){r=!1},2e3))});var s=function(){g.calcPageSize(a,!1)};a.clickThumb=function(b,c){var d={breadCrumb:i,depth:n,cache:o,openCollection:j,newCollectionUrl:p},e=g.clickThumb(b,a,d,c);i=e.breadCrumb,o=e.cache,j=e.openCollection,p=e.newCollectionUrl,n=e.depth},a.expanded=!1,a.breadCrumbClick=function(b){for(a.collection=o[b];i.length-1>b;)i.pop(),o.pop();a.currentPage=0,s()},$(window).on("resize",function(){a.currentPage=0,s()}),a.preventClickBubble=function(a){a.stopImmediatePropagation()},a.initExploreView()}]),wwt.controllers.controller("SearchController",["$scope","$rootScope","$timeout","Util","SearchUtil","ThumbList",function(a,b,c,d,e,f){a["goto"]={RA:"",Dec:""};var g=function(){f.init(a,"search"),d.isMobile&&(a.scrollDepth=40),c(function(){a.SearchType="J2000",$("#txtSearch").focus()},123)};a.clickThumb=function(b){f.clickThumb(b,a)};var h=function(){f.calcPageSize(a,!1)};a.expanded=!1,a.expandThumbnails=function(b){a.currentPage=0,a.expanded=void 0!=b?b:!a.expanded,a.expandTop(a.expanded),h()},$(window).on("resize",function(){a.currentPage=0,h()}),a.gotoCoord=function(){var c=wwtlib.Place.create("tmp",d.parseHms(a["goto"].Dec),d.parseHms(a["goto"].RA),null,null,wwtlib.ImageSetType[a.lookAt.toLowerCase()],60);b.singleton.gotoTarget(c,!1,!1,!0)},a.searchKeyPress=function(){c(function(){var b=a.q=$("#txtSearch").val();e.runSearch(b).then(function(b){a.collection=b,h()})},10)},g()}]),wwt.controllers.controller("SettingsController",["$scope","$rootScope","AppState","$timeout","$cookies","Util","$q",function(a,b,c,d,e,f,g){a.defaults={autoHideTabs:!1,autoHideContext:!1,smoothPanning:!f.isAccelDevice(),version:"5.1.02",crosshairs:!0},g.all([a.getFromEn("HTML5"),a.getFromEn("Silverlight")]).then(function(b){a.availableClients=[{code:"HTML5",label:b[0]},{code:"SL",label:b[1]}]});var h;a.setClientPref=function(){f.log(a.preferredClient),e.preferredClient=a.preferredClient,"SL"==a.preferredClient&&(a.redirecting=!0,a.redirectingSeconds=5,setInterval(function(){d(function(){a.redirectingSeconds--})},1e3),h=setTimeout(function(){location.reload()},5e3))},a.cancelRedir=function(){clearTimeout(h),a.redirecting=!1},d(function(){a.preferredClient=e.preferredClient||a.availableClients[0].code},10),a.$on("restoreDefaults",function(){c.set("settings",null),a.retrieveSettings()}),a.retrieveSettings=function(){a.savedSettings=c.get("settings"),a.savedSettings&&a.savedSettings.version&&a.savedSettings.version==a.defaults.version||(a.savedSettings=a.defaults),void 0===a.savedSettings.crosshairs&&(a.savedSettings=a.defaults),a.saveSettings(!0)},a.WebGl=c.get("WebGl")?!0:!1,a.setWebGl=function(){c.set("WebGl",a.WebGl),location.reload()},a.saveSettings=function(b){d(function(){$.each(a.savedSettings,function(c,d){(a[c]!==d||b)&&(b?a[c]=d:a.savedSettings[c]=!d,"autoHideContext"===c&&(a.savedSettings.autoHideContext?b&&a.autoHideContext&&setTimeout(function(){p=!1},1200):r.fadeIn(800,function(){p=!1})),"autoHideTabs"===c&&(a.savedSettings.autoHideTabs?b&&a.autoHideTabs&&setTimeout(function(){o=!1},1200):q.fadeIn(800,function(){o=!1})))}),wwt.wc.settings.set_showCrosshairs(a.crosshairs),wwt.wc.settings.set_smoothPan(a.smoothPanning),c.set("settings",a.savedSettings)},10)};var i,j,k,l,m=!1,n=!1,o=!1,p=!1,q=$("#topPanel, .layer-manager"),r=$(".context-panel");$(window).on("mousemove touchstart touchmove touchend",function(b){if(wwt.tourPlaying)return k=!1,void(l=!1);if(a.savedSettings.autoHideContext||a.savedSettings.autoHideTabs){r.length||(r=$(".context-panel")),q.length<2&&(q=$("#topPanel, .layer-manager"));var c=void 0!=b.pageY?b.pageY:b.originalEvent.targetTouches[0].pageY;n=$(window).height()-123<c,m=142>c,a.savedSettings.autoHideTabs&&(m?(clearTimeout(j),o&&1!=k&&(o=!1,k=!0,q.fadeIn(800,function(){k=!1}))):o||(clearTimeout(j),j=setTimeout(function(){o=!0,q.fadeOut(800)},1500))),a.savedSettings.autoHideContext&&(n?(clearTimeout(i),p&&1!=l&&(p=!1,l=!0,r.fadeIn(800,function(){l=!1}))):p||(clearTimeout(i),i=setTimeout(function(){p=!0,r.fadeOut(800)},1500)))}}),a.retrieveSettings()}]),wwt.controllers.controller("ViewController",["$scope","AppState","$timeout","Util","$rootScope",function(a,b,c,d,e){function f(){(a.activePanel===a.loc.view||d.isMobile)&&c(function(){var b=a.now=h.get_now();a.year=b.getFullYear(),a.month=(b.getMonth()+1)%12,a.date=b.getDate(),a.hours=b.getHours(),a.minutes=b.getMinutes(),a.seconds=b.getSeconds()})}function g(){var b=h.get_timeRate();-2==b&&(b=-1),1==b?a.TimeMode=a.loc.realTime:-2==h.TimeRate?a.TimeMode=a.loc.reverseime:a.TimeMode="X "+b,h.get_syncToClock()||(a.TimeMode=a.TimeMode+" : "+a.loc.paused)}var h=a.spaceTimeController=wwtlib.SpaceTimeController;a.galaxyModeChange=function(){a.galaxyMode&&a.viewFromLocation&&(a.viewFromLocation=!1,a.setViewFromLocation()),wwt.wc.settings.set_galacticMode(a.galaxyMode)},wwtlib.WWTControl.useUserLocation(),a.locationName=a.getFromEn("My Location"),a.now=new Date,a.loc={view:"View",realTime:"Real Time",reverseTime:"Reverse Time",paused:"Paused"},e.languagePromise.then(function(){a.loc.view=a.getFromEn("View"),a.loc.realTime=a.getFromEn("Real Time"),a.loc.reverseTime=a.getFromEn("Reverse Time"),a.loc.paused=a.getFromEn("Paused")}),a.fastBack_Click=function(){var a=h.get_timeRate();-2>a&&a>=-1e9?h.set_timeRate(10*a):h.set_timeRate(-10),h.set_syncToClock(!0),g()},a.back_Click=function(){var a=h.get_timeRate();-10>=a?(h.set_timeRate(a/10),h.set_syncToClock(!0)):(h.set_timeRate(-2),h.set_syncToClock(!0)),-1==h.get_timeRate()&&h.set_timeRate(-2),g()},a.pause_Click=function(){h.set_syncToClock(!h.set_syncToClock),g()},a.play_Click=function(){var a=h.get_timeRate();a>=10?a/=10:a=1,h.set_timeRate(a),h.set_syncToClock(!0),g()},a.fastForward_Click=function(){var a=h.get_timeRate();a>0&&1e9>=a?h.set_timeRate(10*a):h.set_timeRate(10),h.set_syncToClock(!0),g()},a.timeNow_Click=function(){h.set_syncToClock(!0),h.syncTime(),h.set_timeRate(1),g()},a.setViewFromLocation=function(){a.galaxyMode&&a.viewFromLocation&&(a.galaxyMode=!1,a.galaxyModeChange()),e.ctl.settings.set_localHorizonMode(a.viewFromLocation)},setInterval(f,300),g()}]),wwt.controllers.controller("ToursController",["$scope","$rootScope","AppState","Tours","$timeout","Util","$popover",function(a,b,c,d,e,f,g){var h,i=1,j=[a.getFromEn("Tours")],k=[];a.pageCount=1,a.pageSize=1,a.currentPage=0,d.getRoot().then(function(b){a.tourList=h=b,a.breadCrumb=j,k.push(b),l()}),a.clickThumb=function(c){return a.activeItem=c.get_thumbnailUrl()+c.get_name(),"Up Level"===c.get_name()?(a.currentPage=0,i--,j.pop(),a.breadCrumb=j,k.pop(),a.tourList=k[k.length-1],void l()):(c.get_isFolder()&&(a.currentPage=0,i++,j.push(c.get_name()),a.breadCrumb=j,d.getChildren(c).then(function(b){a.tourList=b,k.push(b),l()})),void(ss.canCast(c,wwtlib.Tour)&&(a.playTour(c.get_tourUrl()),f.isMobile&&(b.landscapeMessage=!0,setTimeout(function(){a.$hide()},2222)))))},a.breadCrumbClick=function(b){for(a.tourList=k[b];j.length-1>b;)j.pop(),k.pop()};var l=function(){e(function(){var b=118,c=$(window).width();a.pageSize=Math.floor(c/b),a.pageCount=Math.ceil(a.tourList.length/a.pageSize)},1)},m=null,n=null;a.tourPreview=function(c,e){if(!e.get_isFolder()&&"Up Level"!==e.get_name()){a.relatedTours=d.getToursById(e.relatedTours),b.tour=e,n||(n=$("<div></div>").css({height:70,width:120,top:-999,left:-999,opacity:0,background:"#fff",position:"fixed",zIndex:2}).on("mouseleave",o),$("body").append(n)),m&&m.hide();var f={title:e.get_name(),target:$(c.currentTarget),id:"tourpop",templateUrl:"views/popovers/tour-template.html",contentTemplate:"views/popovers/tour-info.html",placement:"bottom-left",scope:a,trigger:"manual"};m=g($(c.currentTarget),f),m.$promise.then(function(){m.show();var a=$(c.currentTarget),b=a.offset();n.css({top:b.top-2,left:b.left-2,opacity:.01});var d=function(){$(".tour-info .author-image img").each(function(){this.naturalHeight>0&&0===$(this).height()&&$(this).css({height:this.naturalHeight,width:this.naturalWidth})})};$(".tour-info img").off("load"),$(".tour-info img").on("load",d),setTimeout(d,500),setTimeout(d,1500)})}};var o=function(){n.css({top:-999,left:-999})};$(window).on("resize",l)}]),wwt.controllers.controller("CommunityController",["$scope","Util","$timeout","ThumbList","Community",function(a,b,c,d,e){var f,g=1,h=[];a.initCommunityView=function(){d.init(a,"communities"),e.getRoot().then(function(b){$("body").append($("#researchMenu")),a.collection=b;var c=a.getFromEn("Collections");c.then?c.then(function(b){a.breadCrumb=f=[b]}):a.breadCrumb=f=[c],h=[b],i()})};var i=function(){d.calcPageSize(a,!1)};a.clickThumb=function(b,c){var e={breadCrumb:f,depth:g,cache:h},i=d.clickThumb(b,a,e,c);f=i.breadCrumb,h=i.cache,g=i.depth},a.expanded=!1,a.breadCrumbClick=function(b){for(a.collection=h[b];f.length-1>b;)f.pop(),h.pop();a.currentPage=0,i()},$(window).on("resize",function(){a.currentPage=0,i()}),a.preventClickBubble=function(a){a.stopImmediatePropagation()},a.initCommunityView()}]),wwt.controllers.controller("CurrentTourController",["$scope","$rootScope","Util","MediaFile",function(a,b,c,d){var e,f=a.tourEdit=wwtlib.WWTControl.singleton.tourEdit;a.init=function(c){a.musicFileUrl=!1,a.voiceOverFileUrl=!1,a.musicPlaying=!1,a.voiceOverPlaying=!1,b.currentTour=a.tour=e=f.get_tour(),f.tourStopList.refreshCallback=i,a.editText=null,f.tourEditorUI.editTextCallback=function(b,c){a.editText={textObject:b,onFinished:c},$("#editTourText").click()},i(!0),b.$watch("editingTour",function(){}),h(),$("#contextmenu,#popoutmenu").on("click",i),setTimeout(g,111)};var g=function(){var a=function(a,b){return b.volume=.5,{el:a,bounds:{x:[-50,50],y:[0,0]},onstart:function(){a.addClass("moving")},onmove:function(){b.volume=this.css.left/100},oncomplete:function(){a.removeClass("moving")}}};new wwt.Move(a($("#musicVol"),$("#musicPlayer")[0])),new wwt.Move(a($("#voiceVol"),$("#voiceOverPlayer")[0]))};a.tourProp=function(a,b){e["set_"+b](a.target.value)},a.saveTour=function(){var a=e.getTourXML();console.log(a)},a.addShape=function(a){f.tourEditorUI.addShape("",a)},a.mediaFileChange=function(b,c,e){console.time("storeLocal: "+c);var g=b.target.files[0];g.name&&(a[c+"FileName"]=g.name,d.addTourMedia(c,g).then(function(b){e||(a[c+"FileUrl"]=!0,$("#"+c+"Player").attr("src",b.url),a[c+"Playing"]=!1),console.timeEnd("storeLocal: "+c),e?(console.log("image created: "+b.url),f.tourEditorUI.addPicture(b.url)):f.tourEditorUI.addAudio(b.url)}))},a.toggleSound=function(b){var c=$("#"+b+"Player")[0];a[b+"Playing"]?c.pause():c.play(),a[b+"Playing"]=!a[b+"Playing"]};var h=function(){$("#ribbon,.top-panel,.context-panel,.layer-manager").removeClass("hide").fadeIn(400),b.tourPaused=!0,a.escaped=!0,b.editingTour=!0,setTimeout(function(){b.stopScroller=$(".scroller").jScrollPane({scrollByY:155,horizontalDragMinWidth:155}).data("jsp"),$(window).on("resize",function(){b.stopScroller.reinitialise()})},200)};a.showContextMenu=function(b,c){c&&(a.selectStop(b),f.tourStopList_MouseClick(b,c))},a.selectStop=function(b,c){a.$applyAsync(function(){if(f.tourStopList.selectedItem=a.tourStops[b],a.activeIndex=b,c&&c.shiftKey){f.tourStopList.selectedItems={};for(var d=Math.min(b,a.lastFocused);d<=Math.max(b,a.lastFocused);d++)f.tourStopList.selectedItems[d]=a.tourStops[d]}else if(c&&c.ctrlKey){var g=Object.keys(f.tourStopList.selectedItems);f.tourStopList.selectedItems[b]&&g.length>1?(delete f.tourStopList.selectedItems[b],a.activeIndex=g[0]):f.tourStopList.selectedItems[b]=a.tourStops[b]}else f.tourStopList.selectedItems={},f.tourStopList.selectedItems[b]=a.tourStops[b];e.set_currentTourstopIndex(a.activeIndex),a.lastFocused=b})},a.showStartCameraPosition=function(a){e.set_currentTourstopIndex(a),f.tourStopList_ShowStartPosition()},a.showEndCameraPosition=function(a){e.set_currentTourstopIndex(a),f.tourStopList_ShowEndPosition()},a.pauseTourEdit=function(){f.playing?f.pauseTour():a.activeIndex?f.playFromCurrentTourstop():f.playNow(!0),b.tourPaused=!wwtlib.WWTControl.singleton.tourEdit.playing};var i=a.refreshStops=function(b){a.$applyAsync(function(){e.duration=0,a.tourStops=e.get_tourStops().map(function(a){return a.description=a.get_description(),a.thumb=a.get_thumbnail(),a.duration=a.get_duration(),e.duration+=a.duration,a.atime=a.get__transitionTime(),a.btime=a.get__transitionOutTime(),a.holdtime=a.get__transitionHoldTime(),a.transitionType=a.get__transition(),a.isMaster=a.get_masterSlide(),
a}),e.minuteDuration=Math.floor(e.duration/6e4),e.secDuration=Math.floor(e.duration%6e4/1e3),a.tour=e,b&&b===!0&&(a.selectStop(0),a.tourStops.length<2&&"New Tour"===e._title&&setTimeout(function(){$("#newTourProps").click()},500))})};a.setStopTransition=function(b,c,d){if(c||0===c){var e=a.tourStops[b];return e.set__transition(c),void(e.transitionType=c)}if(d&&"string"==typeof d)switch(d){case"atime":e.set__transitionTime(e.atime);break;case"btime":e.set__transitionOutTime(e.btime);break;case"holdtime":e.set__transitionHoldTime(e.holdtime)}}}]),wwt.controllers.controller("TourSlideText",["$scope","$rootScope","Util","$timeout",function(a,b,c,d){function e(){i=angular.element("#currentTourPanel").scope(),i.editText&&(j=i.editText.textObject,k=Object.assign({},j))}function f(){g=$(".modal.tour-text iframe").contents().find("body"),i.editText&&(g.html(""),k.text.split("\n").forEach(function(a,b){g.append($("<p></p>").html(a))}),g.find("p").css({color:k.foregroundColor,backgroundColor:k.backgroundColor,fontWeight:k.fontWeight?"bold":"normal",fontSize:k.fontSize+"pt",textDecoration:k.underline?"underline":"none",fontStyle:k.italic?"italic":"none",fontFamily:k.fontName}));var a=function(a){return new MutationObserver(function(b){l?console.log("not observing after save"):b.forEach(function(){setTimeout(a,100)})})},b={attributes:!0,childList:!0,characterData:!0},c=$('.mce-widget[aria-label="Font Family"] span.mce-txt');c.text(k.fontName);var d=function(a){var b=c.text();return 0===b.indexOf("Font")?void c.text(k.fontName):(g.find("*").css("font-family",c.text()),void(k.fontName=c.text()))},e=$('.mce-widget[aria-label="Font Sizes"] span.mce-txt');e.text(k.fontSize);var f=function(a){var b=e.text();return 0===b.indexOf("Font")?void e.text(k.fontSize):(g.find("*").css("font-size",e.text()),void(k.fontSize=parseInt(e.text().replace("pt",""))))},h=$(".mce-i-bold").parent().parent(),j=function(a){k.bold=h.hasClass("mce-active"),g.find("*").css("font-weight",k.bold?"bold":"normal")},m=$(".mce-i-italic").parent().parent(),n=function(a){k.italic=m.hasClass("mce-active"),g.find("*").css("font-style",k.italic?"italic":"normal")},o=$(".mce-i-underline").parent().parent(),p=function(a){k.underline=o.hasClass("mce-active"),g.find("*").css("text-decoration",k.underline?"underline":"none")};a(d).observe(c.parent().parent()[0],b),a(f).observe(e.parent().parent()[0],b),a(j).observe(h[0],b),a(n).observe(m[0],b),a(p).observe(o[0],b);var q=$(".mce-ico.mce-i-backcolor").parent().parent().find(".mce-preview")[0],r=function(a){var b=$(q).css("background-color");k.backgroundColor=b,console.log(b,$(".popover.tour-text iframe").contents()),g.css("background-color",b)},s=$(".mce-ico.mce-i-forecolor").parent().parent().find(".mce-preview")[0],t=function(a){var b=$(s).css("background-color");g.find("*").css("color",b)},u={attributes:!0,childList:!1,characterData:!1};a(t).observe(s,u),a(r).observe(q,u)}var g,h=wwtlib.WWTControl.singleton.tourEdit.tourEditorUI,i=null,j=null,k={text:"",foregroundColor:"#ffffff",backgroundColor:"transparent",bold:0,italic:0,underline:0,fontSize:24,fontName:"Arial",borderStyle:"None"},l=!1,m=0,n=function(){m++,$(".modal .mce-ico.mce-i-forecolor").length?(console.log("editor ready"),f()):(console.log(m+" init attempts"),setTimeout(n,100))},o=a.hideEditor=function(){i.editText&&(i.editText.onFinished(j),i.editText=null),a.$parent.$applyAsync(function(){a.$parent.$hide()})};d(function(){tinymce.init({selector:"textarea.tour-text",fontsize_formats:"8pt 9pt 10pt 11pt 12pt 14pt 16pt 18pt 20pt 24pt 28pt 32pt 36pt 40pt 44pt 48pt 54pt 60pt 66pt 72pt 80pt 88pt 96pt 112pt 128pt 150pt 200pt",height:500,theme:"modern",plugins:["save contextmenu textcolor colorpicker"],toolbar1:"save | undo redo | fontselect fontsizeselect | bold italic underline | forecolor backcolor ",toolbar2:"",save_onsavecallback:function(){l=!0,k.text="",g.find("p").each(function(a,b){a>0&&(k.text+="\n"),k.text+=$(b).text()}),console.log(k);try{var a=i.editText?i.editText.textObject:wwtlib.TextObject.create(k.text,k.bold,k.italic,k.underline,k.fontSize,k.fontName,k.foregroundColor,k.backgroundColor,k.borderStyle);i.editText?(i.editText.onFinished(k),i.editText=null):h.addText({},a)}catch(b){}o()},content_css:"css/mcecontent.css"}),n()},10),e()}]),wwt.controllers.controller("ShareController",["$scope","$rootScope","Util","$timeout","HashManager",function(a,b,c,d,e){a.includeViewport=!0,a.init=function(){a.shareUrlReadOnly=a.shareUrl,"Sky"!==a.lookAt?a.shareUrlReadOnly=e.setHashVal("lookAt",a.lookAt,!0):"Earth"===a.lookAt&&(a.shareUrlReadOnly=a.shareUrl=e.removeHashVal("place",!0)),a.backgroundImagery&&"Digitized Sky Survey (Color)"!=a.backgroundImagery.get_name()&&(a.shareUrlReadOnly=a.shareUrl=e.setHashVal("imagery",a.backgroundImagery.get_name(),!0)),"100px"!=$(".cross-fader a.btn").css("left")&&(a.shareUrlReadOnly=a.shareUrl=e.setHashVal("cf",$(".cross-fader a.btn").css("left").replace(/px/,""),!0)),$("#shareUrl").on("focus",function(){$(this).select()}),a.includeViewportChange(),f(999)},b.$on("viewportchange",a.init),a.includeViewportChange=function(){a.includeViewport?(e.setHashVal("ra",b.viewport.RA.toFixed(5),!0),e.setHashVal("dec",b.viewport.Dec.toFixed(5),!0),a.shareUrlReadOnly=a.shareUrl=e.setHashVal("fov",b.viewport.Fov.toFixed(5),!0)):(e.removeHashVal("ra",!0),e.removeHashVal("dec",!0),a.shareUrlReadOnly=a.shareUrl=e.removeHashVal("fov",!0)),$('meta[property="og:url"]').attr("content",a.shareUrlReadOnly),$('meta[property="og:title"]').attr("content",a.trackingObj?a.trackingObj.get_name()+" - WorldWide Telescope":a.getFromEn("WorldWide Telescope Web Client")),$('meta[property="og:image"]').attr("content",a.trackingObj?a.trackingObj.get_thumbnailUrl():location.host+"/webclient/Images/wwtlogo.png"),f(222)};var f=function(a){setTimeout(function(){$("#shareUrl")[0].focus(),$("#shareUrl")[0].select()},a)};a.hide=function(){a.$parent.$hide()}}]),wwt.controllers.controller("OpenItemController",["$rootScope","$scope","AppState","Places","Util","Astrometry",function(a,b,c,d,e,f){b.openItem=function(c){"collection"===c?d.openCollection(b.openItemUrl).then(function(c){e.log("initExplorer broadcast",c),a.newFolder=c,a.$broadcast("initExplorer",b.openItemUrl),$("#openModal").modal("hide")}):"tour"===c?(b.playTour(b.openItemUrl),$("#openModal").modal("hide")):d.importImage(b.openItemUrl).then(function(c){c?(e.log("initExplorer broadcast",c),a.newFolder=c,a.$broadcast("initExplorer",b.openItemUrl),$("#openModal").modal("hide")):(b.importState="notAVMTagged",b.imageFail=!0)})},b.astrometryStatusText="",b.astroCallback=function(c){if(0==b.astrometryStatusText.indexOf(c.message)?b.astrometryStatusText+=" .":b.astrometryStatusText=c.message,c.calibration){b.importState="astrometrySuccess";var e="&ra="+c.calibration.ra+"&dec="+c.calibration.dec+"&scale="+c.calibration.scale/3600+"&rotation="+c.calibration.rotation;1!==c.calibration.parity&&(e+="&reverseparity=true"),d.importImage(b.openItemUrl,e).then(function(c){a.newFolder=c,a.$broadcast("initExplorer",b.openItemUrl),b.imageFail=!1,b.importState="",$("#openModal").modal("hide")})}-1!=c.status.toLowerCase().indexOf("fail")&&(b.importState="astrometryFail")},b.solveAstrometry=function(){b.importState="astrometryProgress",f.submitImage(b.openItemUrl,b.astroCallback,!1)}}]),wwt.controllers.controller("ObservingTimeController",["$scope","AppState",function(a,b){var c=a.now;a.dt={},a.dt.year=c.getFullYear(),a.dt.month=(c.getMonth()+1)%12,a.dt.date=c.getDate(),a.dt.hours=c.getHours(),a.dt.minutes=c.getMinutes(),a.dt.seconds=c.getSeconds(),a.setNow=function(){var b=new Date(parseInt(a.dt.year),parseInt(a.dt.month)-1,parseInt(a.dt.date),parseInt(a.dt.hours),parseInt(a.dt.minutes),parseInt(a.dt.seconds));wwtlib.SpaceTimeController.set_now(b)}}]),wwt.controllers.controller("LoginController",["$scope","$rootScope","$http","Util","$cookies","$timeout",function(a,b,c,d,e,f){function g(){if(b.liveAppId=$("body").data("liveid"),null!=d.getQSParam("code")){var a=location.href.split("?")[0];location.href="/LiveId/AuthenticateFromCode/"+d.getQSParam("code")+"?returnUrl="+encodeURIComponent(a)}else e.get("access_token")&&(b.loggedIn=!0)}b.loggedIn=!1,a.login=function(){localStorage.setItem("login",(new Date).valueOf());var a="http://"+location.host+"/webclient",c="https://login.live.com/oauth20_authorize.srf?client_id="+b.liveAppId+"&scope=wl.offline_access%20wl.emails&response_type=code&redirect_uri="+encodeURIComponent(a)+"&display=popup";location.href=c},a.logout=function(){localStorage.setItem("login",(new Date).valueOf());var a=localStorage.getItem("userSettings"),b=a?JSON.parse(a):{};b.rememberMe=!1,localStorage.setItem("userSettings",JSON.stringify(b)),location.href="/Logout"},g()}]),wwt.Move=function(a){function b(a){if(f=a.bounds||null,e=a.grid||1,d=a.el,k=a.target||d,h=a.onstart,g=a.onmove,i=a.oncomplete,c(),window.PointerEvent||window.MSPointerEvent){k.css("touch-action","none");var b=window.PointerEvent?"pointerdown":"MSPointerDown",m=window.PointerEvent?"pointerup":"MSPointerUp",n=window.PointerEvent?"pointermove":"MSPointerMove";document.body.addEventListener(b,function(a){k.hasClass("disabled")||a.target!==k[0]&&!$(k).has(a.target).length||j||(document.body.setPointerCapture?document.body.setPointerCapture(a.pointerId):document.body.msSetPointerCapture&&document.body.msSetPointerCapture(a.pointerId),a.preventDefault(),a.stopPropagation(),a.pointerId&&(l=a.pointerId),o(a),document.body.addEventListener(m,q,!1),document.body.addEventListener(n,function(a){l&&a.pointerId===l&&p(a)},!1))},!1)}else k.on("mousedown touchstart",function(a){k.hasClass("disabled")||(a.preventDefault(),a.stopPropagation(),o(a),$(document).on("mouseup touchend",q),$(document).on("mousemove touchmove",p))});d.css({position:"absolute"})}function c(a){if(f=a||f,!f)return m.left=[0-1/0,1/0],void(m.top=[0-1/0,1/0]);var b={left:parseFloat(d.css("left"))||0,top:parseFloat(d.css("top"))||0};f.x?m.left=[b.left+f.x[0],b.left+f.x[1]]:m.left=[0-1/0,1/0],f.y?m.top=[b.top+f.y[0],b.top+f.y[1]]:m.top=[0-1/0,1/0]}var d,e,f,g,h,i,j,k,l,m={left:null,top:null},n={},o=function(a){n.mouseCoord=s(a),n.startCoord={x:parseFloat(d.css("left")),y:parseFloat(d.css("top"))},isNaN(n.startCoord.x)&&(n.startCoord.x=0),isNaN(n.startCoord.y)&&(n.startCoord.y=0),n.moveDist={x:0,y:0},n.totalDist={x:0,y:0},n.clickOffset=wwt.getClickOffset(a),n.css={top:n.startCoord.y,left:n.startCoord.x},n.maxX=m.left[0]+m.left[1],n.maxY=m.top[0]+m.top[1],j=!0,h&&h.call(n)},p=function(a){a.stopPropagation();var b=s(a);n.moveDist={x:b.x-n.mouseCoord.x,y:b.y-n.mouseCoord.y},n.mouseCoord=b,n.css.top+=n.moveDist.y,n.css.left+=n.moveDist.x,n.totalDist={x:n.totalDist.x+n.moveDist.x,y:n.totalDist.y+n.moveDist.y},n.gridCss={left:Math.round(n.totalDist.x/e)*e+n.startCoord.x,top:Math.round(n.totalDist.y/e)*e+n.startCoord.y},n.css=n.gridCss,n.css.top=Math.min(Math.max(m.top[0],n.css.top),m.top[1]),n.css.left=Math.min(Math.max(m.left[0],n.css.left),m.left[1]),n.pctX=Math.max(m.left[0],n.css.left)/n.maxX,n.pctY=Math.max(m.top[0],n.css.top)/n.maxY,d.css(n.css),g&&g.call(n)},q=function(a){l=null,j=!1,$(document).off("mouseup touchend MSPointerUp",q),$(document).off("mousemove touchmove MSPointerMove",p),r(a)},r=function(a){i&&i.call(n),j=n.isMoving=!1,a&&a.preventDefault()},s=function(a){var b={};return a.originalEvent&&a.originalEvent.targetTouches?(b.x=a.originalEvent.targetTouches[0].pageX,b.y=a.originalEvent.targetTouches[0].pageY):a.originalEvent?(b.x=a.originalEvent.pageX,b.y=a.originalEvent.pageY):(b.x=a.pageX,b.y=a.pageY),b};return b(a),{setBounds:c}},wwt.getRGBArray=function(a){try{var b,c=[];if(0==a.indexOf("#"))if(a.length<=5)for(b=1;b<a.length;b++)c.push(16*parseInt("0x"+a.charAt(b),16));else for(b=1;b<a.length;b+=2)c.push(parseInt("0x"+a.substr(b,2),16));else{-1!=a.indexOf(")")&&(a=a.split("(")[1].split(")")[0]);var d=a.split(",");for(b=0;b<d.length;b++)c.push(parseFloat(d[b]))}return c}catch(e){return e}},wwt.getHSV=function(a,b){var c,d,e;b||(b=this.getRGBArray(a)),c=b[0],d=b[1],e=b[2],c/=255,d/=255,e/=255;var f,g,h=Math.min(Math.min(c,d),e),i=Math.max(Math.max(c,d),e),j=i;return g=i==h?0:i==c?60*((d-e)/(i-h))%360:i==d?60*((e-c)/(i-h))+120:i==e?60*((c-d)/(i-h))+240:0,0>g&&(g+=360),f=0==i?0:1-h/i,[Math.round(g),Math.round(100*f),Math.round(100*j)]},wwt.getHex=function(a){a=this.convertToIntArray(a);for(var b="#",c=0;c<a.length;c++){var d=a[c].toString(16);b+=1==d.length?"0"+d:d}return b},wwt.rgbFromHSV=function(a){var b=a[0],c=a[1]/100,d=a[2]/100,e=Math.floor(b/60%6),f=b/60-e,g=d*(1-c),h=d*(1-f*c),i=d*(1-(1-f)*c),j=[];switch(e){case 0:j=[d,i,g];break;case 1:j=[h,d,g];break;case 2:j=[g,d,i];break;case 3:j=[g,h,d];break;case 4:j=[i,g,d];break;case 5:j=[d,g,h]}var k=Math.min(255,Math.round(256*j[0])),l=Math.min(255,Math.round(256*j[1])),m=Math.min(255,Math.round(256*j[2]));return[k,l,m]},wwt.blendColors=function(a,b,c,d,e){var f=(e-c)/(d-c),g=[],h=!1;a[3]&&a[3]<=1&&a[3]>=0&&(h=!0,a[3]=Math.round(1e3*a[3]),b[3]=Math.round(1e3*b[3]));for(var i=0;i<a.length;i++){var j=b[i],k=a[i],l=k>j,m=l?k-j:j-k,n=Math.round(m*f);g[i]=l?k-n:n+k}return h&&(g[3]=g[3]/1e3,a[3]=a[3]/1e3,b[3]=b[3]/1e3),g},wwt.convertToIntArray=function(a){for(var b=0;b<a.length;b++)a[b]=parseInt(a[b]);return a},wwt.rnd=function(a){var b=Math.random(),c=16180339;return b=b*c%1,b=Math.floor(b*a+1)},wwt.getClickOffset=function(a){var b={x:a.pageX,y:a.pageY},c=$(a.target).offset();return{x:b.x-c.left,y:b.y-c.top}},wwt.getAngle=function(a,b,c){(a.left||0==a.left)&&(a.x=a.left,a.y=a.top,b.x=b.left,b.y=b.top);var d=Math.abs(a.x-b.x),e=Math.abs(a.y-b.y),f=Math.sqrt(d*d+e*e),g=(3600+Math.round(Math.atan2(b.y-a.y,b.x-a.x)/6.28*3600))%3600;return g=3600-g,g/=10,c?{dist:f,deg:g%360}:g%360},wwt.getCoordsFromDegrees=function(a,b,c,d){return{x:c+b*Math.cos(a*(Math.PI/180)),y:d-b*Math.sin(a*(Math.PI/180))}},wwt.cssInt=function(a,b){return parseInt(a.css(b))},wwt.round=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},wwt.pct=function(a){return Math.round(1e3*a)/10+"%"},wwt.tweenStep=function(a,b,c,d,e,f){var g,h=a,i=b-a,j=c,k=d;switch(e){case 0:return i*j/k+h;case 1:switch(g=1.70158,f){case 1:return i*(j/=k)*j*((g+1)*j-g)+h;case 2:return i*((j=j/k-1)*j*((g+1)*j+g)+1)+h;default:return(j/=k/2)<1?i/2*(j*j*(((g*=1.525)+1)*j-g))+h:i/2*((j-=2)*j*(((g*=1.525)+1)*j+g)+2)+h}case 2:var l=function(a,b,c,d){return(a/=d)<1/2.75?c*(7.5625*a*a)+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},m=function(a,b,c,d){return c-l(d-a,0,c,d)+b};switch(f){case 1:return m(j,h,i,k);case 2:return l(j,h,i,k);default:return k/2>j?.5*m(2*j,0,i,k)+h:.5*l(2*j-k,0,i,k)+.5*i+h}case 3:switch(f){case 1:return-i*(Math.sqrt(1-(j/=k)*j)-1)+h;case 2:return i*Math.sqrt(1-(j=j/k-1)*j)+h;default:return(j/=k/2)<1?-i/2*(Math.sqrt(1-j*j)-1)+h:i/2*(Math.sqrt(1-(j-=2)*j)+1)+h}case 4:switch(f){case 1:return i*(j/=k)*j*j+h;case 2:return i*((j=j/k-1)*j*j+1)+h;default:return(j/=k/2)<1?i/2*j*j*j+h:i/2*((j-=2)*j*j+2)+h}case 5:g=.3*k/4;var n=.3*k,o=i;switch(f){case 1:return 0==j?h:1==(j/=k)?h+i:(g=n/(2*Math.PI)*Math.asin(i/o),-(o*Math.pow(2,10*(j-=1))*Math.sin((j*k-g)*(2*Math.PI)/n))+h);case 2:return 0==j?h:1==(j/=k)?h+i:(g=n/(2*Math.PI)*Math.asin(i/o),o*Math.pow(2,-10*j)*Math.sin((j*k-g)*(2*Math.PI)/n)+i+h);default:return 0==j?h:2==(j/=k/2)?h+i:(n=k*(.3*1.5),!o||o<Math.abs(i)?(o=i,g=n/4):g=n/(2*Math.PI)*Math.asin(i/o),1>j?-.5*(o*Math.pow(2,10*(j-=1))*Math.sin((j*k-g)*(2*Math.PI)/n))+h:o*Math.pow(2,-10*(j-=1))*Math.sin((j*k-g)*(2*Math.PI)/n)*.5+i+h)}case 6:switch(f){case 1:return 0==j?h:i*Math.pow(2,10*(j/k-1))+h;case 2:return j==k?h+i:i*(-Math.pow(2,-10*j/k)+1)+h;default:return 0==j?h:j==k?h+i:(j/=k/2)<1?i/2*Math.pow(2,10*(j-1))+h:i/2*(-Math.pow(2,-10*--j)+2)+h}case 7:switch(f){case 1:return i*(j/=k)*j+h;case 2:return-i*(j/=k)*(j-2)+h;default:return(j/=k/2)<1?i/2*j*j+h:-i/2*(--j*(j-2)-1)+h}case 8:switch(f){case 1:return i*(j/=k)*j*j*j+h;case 2:return-i*((j=j/k-1)*j*j*j-1)+h;default:return(j/=k/2)<1?i/2*j*j*j*j+h:-i/2*((j-=2)*j*j*j-2)+h}case 9:switch(f){case 1:return i*(j/=k)*j*j*j*j+h;case 2:return i*((j=j/k-1)*j*j*j*j+1)+h;default:return(j/=k/2)<1?i/2*j*j*j*j*j+h:i/2*((j-=2)*j*j*j*j+2)+h}case 10:switch(f){case 1:return-i*Math.cos(j/k*(Math.PI/2))+i+h;case 2:return i*Math.sin(j/k*(Math.PI/2))+h;default:return-i/2*(Math.cos(Math.PI*j/k)-1)+h}}return 0},wwt.clone=function(a){return $.parseJSON(JSON.stringify(a))},wwt.requestFullScreen=function(a){a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():console.log("Fullscreen API is not supported")},wwt.exitFullScreen=function(a){var b=document.fullScreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;b?b.cancelFullScreen?b.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),a&&setTimeout(function(){a({fullscreen:!1})},888)};